/*
 * Storybook Plus
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/sbplus
 * @version: 2.7.0
 * Released 8/--/2015
 *
 * @license: GNU GENERAL PUBLIC LICENSE v3
 *
    Storybook Plus is an web application that serves multimedia contents.
    Copyright (C) 2013-2015  Ethan S. Lin, UWEX CEOEL Media Services

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
var topicCount=0,counter=0,previousIndex=0,tocIndex=0,noteArray,topicSrc,topicTitle,imgPath,slideImgFormat="png",accent="",media="Slide",version,imgCaption,questions,quizDetected=!1,PROFILE,lessonTitle,instructor,duration,mediaPlayer=null,kalturaLoaded=0,ROOT_PATH="https://media.uwex.edu/app/storybook_plus_v2/";$(document).ready(function(){$.fn.getLessonContent("assets/topic.xml")}),$.fn.getLessonContent=function(e){$.ajax({url:e,type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1,encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(e){$.fn.parseContent(e)},error:function(e,t){$.fn.displayGetLessonError(e.status,t)}})},$.fn.parseContent=function(e){var t=$(e),s=t.find("setup"),i=t.find("topic"),n=$.fn.stripScript(s.find("lesson").text()),o=$.trim(s.find("instructor").text()),a=$.fn.stripScript(s.find("length").text()),r=$.fn.stripScript(s.find("slideImgFormat").text()),c=$.fn.stripScript(s.find("accent").text());PROFILE=$.fn.stripScript(t.find("profile").text()),lessonTitle="Lesson name is not specified.",instructor="Instructor name is not specified.",duration="",n.length&&(lessonTitle=n),o.length&&(instructor=o),a.length&&(duration=a),r.length&&(slideImgFormat=r.toLowerCase()),c.length&&(accent=c),topicSrc=[],topicTitle=[],noteArray=[],questions=[],i.each(function(){if(topicTitle[topicCount]=$.trim($(this).attr("title")),topicSrc[topicCount]=$.trim($(this).attr("src")),noteArray[topicCount]=$.fn.stripScript($(this).find("note").text()),"quiz"===topicSrc[topicCount]){var e=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("question").text()),s=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").find("question").attr("img")),i=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").find("question").attr("audio")),n=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("choice").text()),o=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").find("choice").attr("useImg")),a=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("wrongFeedback").text()),r=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("correctFeedback").text()),c=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").attr("type")),l=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("answer").text()),d={};d.id=topicCount,d.type=c,d.question=e,""!==s?d.img=s:d.img="",""!==i?d.audio=i:d.audio="",""!==o?d.choiceImg=o:d.choiceImg="",n?(d.choice=$.fn.splitSelections(n),d.wrongFeedback=$.fn.splitSelections(a)):d.wrongFeedback=a,d.answer=$.fn.splitSelections(l),d.stuAnswer="",d.correct=!1,d.correctFeedback=r,d.taken=!1,questions.push(d)}++topicCount}),questions.length&&(quizDetected=!0),$.fn.setupPlayer()},$.fn.setupPlayer=function(){var e;version=void 0===$("#storybook_plus_wrapper").attr("data-version")?"":$("#storybook_plus_wrapper").attr("data-version").replace(/\./g,""),$(document).attr("title",lessonTitle),$("#errorMsg").hide(),$.each(topicSrc,function(e){var t=topicSrc[e].substring(0,topicSrc[e].indexOf(":")+1);return"video:"!==t&&"youtube:"!==t&&"vimeo:"!==t&&"kaltura:"!==t?(media="Slide",!1):void(media="Video")}),(quizDetected===!0||version>=230)&&$("#storybook_plus_wrapper").addClass("withQuiz"),$("#selectable").before('<div class="toc_heading" tabindex="13">Table of Contents</div>'),$.each(topicTitle,function(t){e="quiz"===topicSrc[t]?' <span class="icon-assessement light"></span>':"",$("#selectable").append('<li class="ui-widget-content" role="menuitem" title="'+topicTitle[t]+'"><div class="slideNum">'+$.fn.addLeadingZero(t+1)+'.</div><div class="title">'+topicTitle[t]+e+"</div></li>")}),$("#splash_screen").css("background-image","url(assets/splash.jpg)"),$("#splash_screen").append("<p>"+lessonTitle+"</p><p>"+instructor+"</p>"+(0!==duration?"<p><small>"+duration+"</small></p>":"")+'<a role="button" class="playBtn" href="#"><span class="sr-only">Play</span></a>'),accent.length&&$(".playBtn").css("background-color",accent),$(".playBtn").focus(),$("#splash_screen, #playBtn").on("click",function(){return $.fn.initializePlayer(),!1}),$.fn.getDownloadableFiles()},$.fn.initializePlayer=function(){$("#splash_screen").hide(),$("#lessonTitle").attr("title",lessonTitle),$("#lessonTitle").html(lessonTitle),$("#instructorName").html('<a tabindex="2" role="button" class="instructorName" href="#">'+instructor+"</a>"),$("#profile .photo").before('<div class="profileCloseBtn"><a tabindex="6" role="button" id="profileClose" href="#"><span aria-hidden="true">&times;</span><span class="sr-only">close</span></a></div>'),$("#profile .bio").html("<h2>"+instructor+"</h2>"+PROFILE),"Video"!==media&&$("#player").append('<div id="progressing"></div>'),$("#info, a.instructorName, #profileClose").on("click",function(){return $("#profile").is(":visible")?$("#profile").fadeOut(300,function(){$("#content").fadeIn("fast",function(){$("#lessonTitle").focus()})}):($("#profile").fadeIn(300,function(){$(".bio").focus()}),$("#content").hide()),!1}),$("#selectable li:first").addClass("ui-selected"),$("#selectable").selectable(),$("#selectable").selectable("option","appendTo","#toc"),$("#selectable").on("selectablestop",function(){tocIndex=Number($(".ui-selected .slideNum").html().replace(".",""))-1,tocIndex!==previousIndex&&($.fn.loadSlide(topicSrc[tocIndex],tocIndex),previousIndex=tocIndex)}),$("#leftBtn").on("click",function(){return $.fn.previousSlide(),!1}),$("#rightBtn").on("click",function(){return $.fn.nextSlide(),!1}),(quizDetected===!0||version>=230)&&($("#control").append('<span role="button" aria-label="expand or contract slide image" tabindex="12" id="magnifyBtn"><span class="icon-expand" title="Expand"></span></span>'),$("#magnifyBtn").before('<span role="button" id="tocBtn" aria-label="Toggle table of content" tabindex="10"><span class="toc" title="Toggle Table of Contents"></span></span>'),$("#magnifyBtn").before('<span id="notesBtn" role="button" aria-label="toggle notes" tabindex="11"><span class="notes" title="Toggle Notes"></span></span>'),$.fn.bindImgMagnify(),$.fn.bindNoteSlideToggle(),$.fn.bindTocSlideToggle()),$.fn.loadSlide(topicSrc[0],counter),$.fn.loadProfilePhoto(),$("#player").show(),$.fn.listenToKeyboard()},$.fn.previousSlide=function(){counter--,0>counter&&(counter=topicCount-1),$.fn.loadSlide(topicSrc[counter],counter),previousIndex=counter},$.fn.nextSlide=function(){counter++,counter>topicCount-1&&(counter=0),$.fn.loadSlide(topicSrc[counter],counter),previousIndex=counter},$.fn.autoscroll=function(){var e=Math.floor($("#selectable").height()),t=Math.floor($(this).position().top);if(t>=488){var s=e/2+$("#selectable")[0].scrollTop;$("#selectable").animate({scrollTop:s},500)}if(32>t){var i=$("#selectable")[0].scrollTop-e/2;$("#selectable").animate({scrollTop:i},500)}},$.fn.loadSlide=function(e,t){var s,i=e.substring(e.indexOf(":")+1);switch("quiz"!==e&&(e=e.substring(0,e.indexOf(":")+1)),"video:"!==e&&"kaltura:"!==e&&"youtube:"!==e&&"vimeo:"!==e&&($("#progressing").fadeIn("fast"),i=i.toLowerCase()),$("#slideNote").hasClass("quizSlide")&&$("#slideNote").removeClass("quizSlide"),null!==mediaPlayer&&($(".vjs-control").blur(),$(".vjs-menu-item").blur(),mediaPlayer.dispose(),mediaPlayer=null,$("#vp").empty().hide(),$("#ap").empty().hide()),$("#slide").html(""),e){case"image:":s=new Image,imgPath="assets/slides/"+i+"."+slideImgFormat,imgCaption=$("#selectable li .title").get(t).innerHTML,$(s).load(function(){$(this).hide(),$("#slide").html('<div id="img"></div>'),$("#slide #img").html(s),$(this).fadeIn(),$(this).focus()}).error(function(){$.fn.displayErrorMsg("image not found!","Expected image: "+imgPath)}).attr({src:imgPath,alt:"Slide "+(t+1)+" "+imgCaption,border:0,tabindex:4});break;case"image-audio:":$.fn.setupMediaPlayer("audio",i);break;case"video:":$.fn.setupMediaPlayer("video",i);break;case"youtube:":$.fn.setupMediaPlayer("youtube",i);break;case"vimeo:":$.fn.setupMediaPlayer("vimeo",i);break;case"kaltura:":$.fn.setupMediaPlayer("kaltura",i);break;case"swf:":$("#slide").html('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+i+'.swf"><param name="movie" value="assets/swf/'+i+'.swf" /><div id="errorMsg"><p>Error: Adobe Flash Player is not enabled or installed!</p><p>Adobe Flash Player is required to view this slide. Please enable or <a href="http://get.adobe.com/flashplayer/" target="_blank">install Adobe Flash Player</a>.</p></div></object>').promise().done(function(){});break;case"quiz":$("#slideNote").addClass("quizSlide"),$.fn.setupQuiz(t);break;default:$.fn.displayErrorMsg("unknow slide type!","Please double check the XML file.")}$(this).loadNote(t),$(this).updateSlideNum(t),$("#progressing").length&&$("#progressing").promise().done(function(){$(this).fadeOut("fast")}),$(".ui-selected").autoscroll(),$("#storybook_plus_wrapper").hasClass("magnified")&&($("#note").hasClass("noNotes")?($("#currentStatus").addClass("extendStatusWidth"),$("#notesBtn").hide()):($("#currentStatus").removeClass("extendStatusWidth"),$("#notesBtn").show()))},$.fn.setupMediaPlayer=function(e,t){var s="",i="";switch(e){case"audio":s="apc",$.get("assets/slides/"+t+"."+slideImgFormat,function(){$("#apc").attr("poster","assets/slides/"+t+"."+slideImgFormat),$.get("assets/audio/"+t+".vtt",function(){i='<track kind="subtitles" src="assets/audio/'+t+'.vtt" srclang="en" label="English">'}).always(function(){var e='<source src="assets/audio/'+t+'.mp3" type="audio/mp3">';$("#ap").html('<audio id="'+s+'" class="video-js vjs-default-skin">'+e+i+"</audio>").promise().done(function(){$.fn.loadVideoJsPlayer(s,t)})})}).fail(function(){$.fn.displayErrorMsg("image not found!","Expected image: assets/slides/"+t+"."+slideImgFormat)});break;case"video":s="vpc",$.get("assets/video/"+t+".vtt",function(){i='<track kind="subtitles" src="assets/video/'+t+'.vtt" srclang="en" label="English">'}).always(function(){var e='<source src="assets/video/'+t+'.mp4" type="video/mp4">';$("#vp").html('<video id="'+s+'" class="video-js vjs-default-skin">'+e+i+"</video>").promise().done(function(){$.fn.loadVideoJsPlayer(s,t)})});break;case"kaltura":s="vpc",0===kalturaLoaded?$.getScript(ROOT_PATH+"/scripts/mwembedloader.js",function(){$.getScript(ROOT_PATH+"/scripts/kwidgetgetsources.js",function(){$.fn.requestKalturaAPI(s,t),kalturaLoaded=1})}):$.fn.requestKalturaAPI(s,t);break;case"youtube":s="ytb",$("#vp").html('<video id="'+s+'" class="video-js vjs-default-skin"></video>').promise().done(function(){$.fn.loadVideoJsPlayer(s,t)});break;case"vimeo":s="vm",$("#vp").html('<video id="'+s+'" class="video-js vjs-default-skin"></video>').promise().done(function(){$.fn.loadVideoJsPlayer(s,t)});break;default:$.fn.displayErrorMsg("Video error!","Please double check your XML file.")}},$.fn.requestKalturaAPI=function(e,t){var s,i,n,o,a={},r;kWidget.getSources({partnerId:1660872,entryId:t,callback:function(t){s=t.entryId,i=t.captionId,n=t.captionExt,o=t.captionLang;for(var c in t.sources){var l=t.sources[c];487061===l.flavorParamsId&&(a.low=l.src),487071===l.flavorParamsId&&(a.normal=l.src),487081===l.flavorParamsId&&(a.high=l.src),487111===l.flavorParamsId&&(a.webm=l.src)}r='<video id="'+e+'" class="video-js vjs-default-skin">',void 0!==a.low&&(r+='<source src="'+a.low+'" type="video/mp4" data-res="low" />'),r+='<source src="'+a.normal+'" type="video/mp4" data-res="normal" data-default="true" />',void 0!==a.low&&(r+='<source src="'+a.high+'" type="video/mp4" data-res="high" />'),void 0!==a.webm&&$.fn.supportWebm()&&(r+='<source src="'+a.webm+'" type="video/webm" />'),null!==i&&(r+='<track kind="subtitles" src="https://cdnapisec.kaltura.com/api_v3/index.php/service/caption_captionAsset/action/serve/captionAssetId/'+i+'" srclang="en" label="English">'),r+="</video>",$("#vp").html(r),$.fn.loadVideoJsPlayer(e)}})},$.fn.loadVideoJsPlayer=function(e,t){var s={techOrder:["html5","flash"],width:640,height:360,controls:!0,autoplay:!0,preload:"auto",plugins:{resolutionSelector:{default_res:"normal"}}};switch(e){case"vpc":$.fn.supportMp4()===!1&&$.fn.supportWebm()===!1&&(s.techOrder=["flash","html5"],s.plugins=null),$("#vp").fadeIn(),$("#vpc").focus();break;case"apc":s.poster="assets/slides/"+t+"."+slideImgFormat,s.plugins=null,$("#ap").fadeIn(),$("#apc").focus(),$("#apc").on("mouseenter",function(){$(this).hasClass("vjs-user-inactive")&&($(this).removeClass("vjs-user-inactive"),$(this).addClass("vjs-user-active"))}),$("#apc").on("mouseleave",function(){$(this).hasClass("vjs-user-active")&&($(this).removeClass("vjs-user-active"),$(this).addClass("vjs-user-inactive"))});break;case"ytb":s.techOrder=["youtube"],s.src="https://www.youtube.com/watch?v="+t,s.plugins=null,$("#vp").fadeIn(),$("#vp").focus();break;case"vm":s.techOrder=["vimeo"],s.src="https://vimeo.com/"+t,s.plugins=null,$("#vp").fadeIn(),$("#vp").focus()}mediaPlayer=videojs(e,s,function(){this.progressTips()}),videojs.options.flash.swf=ROOT_PATH+"videoplayer/video-js.swf"},$.fn.setupQuiz=function(e){for(var t=0,s=!1;!s||t>=questions.length;)questions[t].id===e?s=!0:t++;if($("#slide").html('<div id="quiz"><div class="header"><span class="icon-assessement"></span> Self-Assessment</div>'),questions[t].taken)$.fn.showFeedback(t);else if(""!==questions[t].img){var i=new Image;imgPath="assets/img/"+questions[t].img,$(i).load(function(){$("#quiz").append('<div class="question">'+questions[t].question+"</div>"),$(".question").append(i);var e="";""!==questions[t].audio&&(e='<audio controls><source src="assets/audio/'+questions[t].audio+'.mp3" type="audio/mpeg" /></audio>',$("#quiz").append(e)),$.fn.displayAnswerChoices(t)}).error(function(){$.fn.displayErrorMsg("image not found!","Expected image: "+imgPath)}).attr({src:imgPath,alt:questions[t].question,border:0})}else{var n="";""!==questions[t].audio&&(n='<audio controls><source src="assets/audio/'+questions[t].audio+'.mp3" type="audio/mpeg" /></audio>'),$("#quiz").append('<div class="question">'+questions[t].question+n+"</div>"),$.fn.displayAnswerChoices(t)}},$.fn.displayAnswerChoices=function(e){var t,s=!1;switch(questions[e].type){case"t/f":$("#quiz").append('<div class="answerArea"><label for="t"><input tabindex="0" id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input tabindex="0" type="radio" id="f" name="tf" value="false" /> False</label></div>'),$("label:first-child").focus();break;case"fib":$("#quiz").append('<div class="answerArea"><input type="text" id="saAns" /></div>'),$("#saAns").focus();break;case"mc":var i="radio",n="mc";if(t=questions[e].answer.length,$("#quiz").append('<div class="answerArea">'),t>1&&(i="checkbox",n="ma"),"true"===questions[e].choiceImg)for(var o=0;o<questions[e].choice.length;o++)$(".answerArea").append('<label class="img_choice"for="'+o+'"><input id="'+o+'" type="'+i+'" name="'+n+'" value="'+questions[e].choice[o]+'" /> <img src="assets/img/'+questions[e].choice[o]+'" /></label>');else for(var a=0;a<questions[e].choice.length;a++)$(".answerArea").append('<label for="'+a+'"><input id="'+a+'" type="'+i+'" name="'+n+'" value="'+questions[e].choice[a]+'" /> '+questions[e].choice[a]+"</label>");$("#quiz").append("</div>"),$("label:first-child").focus();break;case"sa":$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>'),$("#saAns").focus();break;default:s=!0,$.fn.displayErrorMsg("unknow question type!","Please double check the topic XML file.")}s||($("#quiz").append('<div class="submitArea"><a id="check" rel="'+e+'" href="#">SUBMIT</a></div>'),$("#slide").append("</div>"),$("#quiz").hide().fadeIn(),$("#check").on("click",function(){var e=Number($(this).attr("rel")),s;switch(questions[e].type){case"t/f":s=$("input:radio[name=tf]:checked").val(),void 0===s&&(s="");break;case"fib":s=$.trim($("#saAns").val());break;case"mc":t>1?(s=[],$("input:checkbox[name=ma]:checked").each(function(){s.push($(this).val())}),questions[e].incorrectIndex=0):(s=$("input:radio[name=mc]:checked").val(),questions[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked"))),(void 0===s||s.length<=0)&&(s="");break;case"sa":s=$.trim($("#saAns").val());break;default:s=""}if(""!==s){switch(questions[e].type){case"fib":for(var i=0;i<questions[e].answer.length;i++)if(s.toLowerCase()===questions[e].answer[i].toLowerCase()){questions[e].correct=!0;break}break;case"t/f":s===String(questions[e].answer)?questions[e].correct=!0:questions[e].correct=!1;break;case"mc":var n=0;if(t>1){for(n=0;n<s.length;n++){if(!($.inArray(s[n],questions[e].answer)>=0)){questions[e].correct=!1;break}questions[e].correct=!0}n<questions[e].answer.length&&(questions[e].correct=!1)}else s===questions[e].answer[0]?questions[e].correct=!0:questions[e].correct=!1;break;default:questions[e].correct=!1}questions[e].stuAnswer=s,questions[e].taken=!0,$.fn.showFeedback(e)}else $(".question").before('<p class="quizIncorrect"><span class="icon-notification"></span> Please answer the question before submitting!</p>'),$(".quizIncorrect").delay(6e3).slideUp("slow",function(){$(".question").prev().remove()});return!1}))},$.fn.showFeedback=function(e){var t="",s="";if($("#slide").html('<div tabindex="5" id="quiz"><div class="header"><span class="icon-assessement"></span> Self-Assessment Feedback</div>'),"sa"!==questions[e].type&&(questions[e].correct?$("#quiz").append('<p class="quizCorrect"><span class="icon-checkmark"></span> CORRECT</p>'):$("#quiz").append('<p class="quizIncorrect"><span class="icon-notification"></span> INCORRECT</p>')),""!==questions[e].img&&(t='<img src="assets/img/'+questions[e].img+'" alt="'+questions[e].question+'" border="0" />'),""!==questions[e].audio&&(s='<audio controls><source src="assets/audio/'+questions[e].audio+'.mp3" type="audio/mpeg" /></audio>'),$("#quiz").append('<div class="question">'+questions[e].question+t+s+"</div>"),"true"===questions[e].choiceImg?($("#quiz").append('<div class="result"><p><strong>Your answer</strong>:<br />'+$.fn.parseArrayImg(questions[e].stuAnswer)+"</p></div>"),$(".result").append("<p><strong>Correct answer</strong>:<br />"+$.fn.parseArrayImg(questions[e].answer)+"</p>")):($("#quiz").append('<div class="result"><p><strong>Your answer</strong>: '+$.fn.parseArray(questions[e].stuAnswer)+"</p></div>"),$(".result").append("<p><strong>Correct answer</strong>: "+$.fn.parseArray(questions[e].answer)+"</p>")),"sa"!==questions[e].type)if(questions[e].correct)""!==String(questions[e].correctFeedback)&&$(".result").append("<p><strong>Feedback:</strong> "+questions[e].correctFeedback+"</p>");else if("mc"===questions[e].type){var i=questions[e].wrongFeedback[questions[e].incorrectIndex];void 0===i&&(i=questions[e].wrongFeedback),""!==String(i)&&$(".result").append("<p><strong>Feedback:</strong> "+i+"</p>")}else""!==String(questions[e].wrongFeedback)&&$(".result").append("<p><strong>Feedback:</strong> "+questions[e].wrongFeedback+"</p>");$("#quiz").focus()},$.fn.loadNote=function(e){var t=noteArray[e];t.length?($("#note").removeClass("noNotes"),$("#note").html(t).hide().fadeIn("fast"),$("#note").find("a").length&&$("#note a").each(function(){$(this).attr("target","_blank")})):($("#note").addClass("noNotes"),$.fn.getProgramLogo())},$.fn.getProgramLogo=function(){var e=$.fn.getProgramDirectory(),t="uw_ex_ceoel_logo",s="University of Wisconsin-Extension Division of Continuing Education, Outreach &amp; E-Learning",i="";switch(e){case"smgt":case"msmgt":t="uw_smgt_logo",s="University of Wisconsin Sustainable Management";break;case"hwm":t="uw_hwm_logo",s="University of Wisconsin Health &amp; Wellness Management";break;case"himt":t="uw_himt_logo",s="University of Wisconsin Health Information Management &amp; Technology";break;case"il":t="uw_il_logo",s="University of Wisconsin Independent Learning";break;case"flx":t="uw_flx_logo",s="University of Wisconsin Flexible Option";break;case"bps":t="uw_bps_logo",s="University of Wisconsin Bachelor of Professional Studies in Organization Leadership and Communication";break;case"ds":t="ds_logo",s="University of Wisconsin Data Science"}i='<img src="'+ROOT_PATH+"img/"+t+'.svg" width="150" height="65" alt="'+s+'" border="0" />',$("#note").attr("aria-label","Notes area. No notes available.").html('<div class="logo" aria-hidden="true">'+i+"</div>")},$.fn.updateSlideNum=function(e){var t=e+1,s=media+" "+t+" of "+topicCount;counter=e,$("#selectable li").each(function(){$(this).removeClass("ui-selected")}),$("#selectable li:nth-child("+t+")").addClass("ui-selected"),$("#currentStatus").html('<span aria-label="'+s+'" tabindex="9" >'+s+"</span>")},$.fn.bindImgMagnify=function(){$("#magnifyBtn").on("click",function(){$("#storybook_plus_wrapper").hasClass("magnified")?($("#storybook_plus_wrapper").removeClass("magnified"),$(this).html('<span class="icon-expand" title="Expand"></span>'),$("#notesBtn, #tocBtn").hide(),$("#toc").css("left","").show(),$("#tocBtn").hasClass("active")&&($("#tocBtn").removeClass("active"),$("#slideNote img").focus())):($("#storybook_plus_wrapper").addClass("magnified"),$(this).html('<span class="icon-contract" title="Contract"></span>'),$("#tocBtn").show(),$("#currentStatus").addClass("extendStatusWidth"),$("#toc").hide(),$("#slideNote img").focus())})},$.fn.bindNoteSlideToggle=function(){var e=$("#note"),t=360,s=536;$("#notesBtn").on("click",function(){var i=Math.ceil(e.offset().top),n=0;i>=s?(n=t,$(this).addClass("active")):(n=s,$(this).removeClass("active")),$("#toc").offset().left<=642&&($("#toc").animate({left:900}),$("#tocBtn").removeClass("active")),e.animate({top:n})})},$.fn.bindTocSlideToggle=function(){var e=$("#toc"),t=642,s=900;$("#tocBtn").on("click",function(){$("#toc").show();var i=Math.ceil(e.offset().left),n=0;i>=s?(n=t,$(this).addClass("active")):(n=s,$(this).removeClass("active")),$("#note").offset().top>=360&&($("#note").animate({top:536}),$("#notesBtn").removeClass("active")),e.animate({left:n},function(){n>=s&&$("#toc").hide()})})},$.fn.loadProfilePhoto=function(){var e=new Image,t="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img tabindex="4" src="'+t+'" border="0" alt="An photo of the instructor" />')}).error(function(){$("#profile .photo").html('<img tabindex="4" src="'+ROOT_PATH+'img/profile.png" width="200" height="300" alt="No instructor photo" border="0" />')}).attr({src:t,border:0})},$.fn.getDownloadableFiles=function(){var e=$.fn.getDirectory(),t=$("#download_bar ul"),s=window.location.href;s=s.substr(0,s.lastIndexOf("/")+1)+e,$.get(s+".pdf",function(){t.append('<li><a tabindex="0" role="button" download href="'+s+'.pdf" target="_blank"><span class="icon-arrow-down"><span><span class="sr-only">Download</span> Transcript</a></li>')}).always(function(){$.get(s+".mp3",function(){t.append('<li><a tabindex="0" role="button" download href="'+s+'.mp3" target="_blank"><span class="icon-arrow-down"><span><span class="sr-only">Download</span> Audio</a></li>')}).always(function(){$.get(s+".zip",function(){t.append('<li><a tabindex="0" role="button" href="'+s+'.zip" target="_blank"><span class="icon-arrow-down"><span><span class="sr-only">Download</span> Supplement</a></li>')})})})},$.fn.displayGetLessonError=function(e,t){var s,i;switch(e){case 0:s="<strong>Error 0</strong> - Not connect. Please verify network.";break;case 200:s="<strong>Error 200</strong> - Invalid characters in XML.";break;case 404:s="<strong>Error 404</strong> - Requested page not found.";break;case 406:s="<strong>Error 406</strong> - Not acceptable error.";break;case 500:s="<strong>Error 500</strong> - Internal Server Error.";break;default:s="Unknow error ... "+e}switch(t){case"parsererror":i="XML parse failed. Please double-check the <strong>topic.xml</strong> file in the <strong>assets</strong> directory. All node values must be wrapped inside <code>&lt;![CDATA[ ... ]]&gt;</code> or use HTML entity for special characters.";break;case"timeout":i="XML parsing timed out. It is taking too long for the browser.";break;case"abort":i="Ajax request aborted.";break;case"error":i="Failed to get requested source. Most likely a 404 or 406.";break;default:i="Uncaught Error ... "+e.responseText}$("#splash_screen, #player").hide(),$("#errorMsg").html("<p>"+s+"</p><p>"+i+"</p>")},$.fn.listenToKeyboard=function(){$(document).on("keypress",function(e){var t=e.which,s="";if(!$("input[type=text], textarea").is(":focus"))switch(t){case 97:s="a",$.fn.previousSlide();break;case 119:s="w",$.fn.previousSlide();break;case 100:s="d",$.fn.nextSlide();break;case 115:s="s",$.fn.nextSlide();break;case 99:s="c";break;case 122:s="z"}})},$.fn.splitSelections=function(e){var t=e.split("|");return t},$.fn.displayErrorMsg=function(e,t){$("#slide").html('<div id="errorMsg"><p><strong>Error:</strong> '+e+"</p><p>"+t+"</p></div>")},$.fn.getDirectory=function(){var e=window.location.href,t;return t=e.split("?"),t=t[0].split("/"),t=t[t.length-2]},$.fn.addLeadingZero=function(e){return 10>e?"0"+e:e},$.fn.parseArray=function(e){var t="";if($.isArray(e))for(var s=0;s<e.length;s++)t+=1===e.length?e[0]:s===e.length-1?e[s]:e[s]+", ";else t=e;return t},$.fn.parseArrayImg=function(e){var t="";if($.isArray(e))for(var s=0;s<e.length;s++)t+='<img src="assets/img/'+e[s]+'" /> ';else t='<img src="assets/img/'+e+'" /> ';return t},$.fn.stripScript=function(e){if(""!==e||void 0!==e){var t=$("<span>"+$.trim(e)+"</span>");return t.find("script,noscript,style").remove().end(),t.html()}return e},$.fn.supportWebm=function(){return!!document.createElement("video").canPlayType('video/webm; codecs="vp8.0, vorbis"')},$.fn.supportMp4=function(){return!!document.createElement("video").canPlayType('video/mp4; codecs="avc1.4D401E, mp4a.40.2"')},$.fn.getProgramDirectory=function(){var e=window.location.href.split("/");return void 0===e[4]?"":e[4]};