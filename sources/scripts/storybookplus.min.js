/*
 * Storybook Plus
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/sbplus
 * @version: 2.6.0
 * Released 4/1/2015
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2013-2015 UWEX CEOEL Media Services
 *
 */
var topicCount=0,counter=0,previousIndex=0,tocIndex=0,noteArray,topicSrc,topicTitle,imgPath,slideImgFormat="png",media="Slide",enabledNote=!1,version,imgCaption,questions,quizDetected=!1,PROFILE,lessonTitle,instructor,duration,videoPlayer=null,audioPlayer,firstAudioLoad=!1,audioPlaying=!1,sources,kalturaLoaded=0,ROOT_PATH="https://media.uwex.edu/app/storybook_plus_v2/";$(document).ready(function(){$.fn.getLessonContent("assets/topic.xml")}),$.fn.getLessonContent=function(e){$.ajax({url:e,type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1,encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(e){$.fn.parseContent(e)},error:function(e,t){$.fn.displayGetLessonError(e.status,t)}})},$.fn.parseContent=function(e){var t=$(e),i=t.find("setup"),s=t.find("topic"),o=$.fn.stripScript(i.find("lesson").text()),n=$.trim(i.find("instructor").text()),a=$.fn.stripScript(i.find("length").text()),r=$.fn.stripScript(i.find("note").text()),l=$.fn.stripScript(i.find("slideImgFormat").text());PROFILE=$.fn.stripScript(t.find("profile").text()),lessonTitle="Lesson name is not specified.",instructor="Instructor name is not specified.",duration="",o.length&&(lessonTitle=o),n.length&&(instructor=n),a.length&&(duration=a),r.length&&("yes"===r||"y"===r)&&(enabledNote=!0),l.length&&(slideImgFormat=l.toLowerCase()),topicSrc=[],topicTitle=[],noteArray=[],questions=[],s.each(function(){if(topicTitle[topicCount]=$.trim($(this).attr("title")),topicSrc[topicCount]=$.trim($(this).attr("src")),enabledNote&&(noteArray[topicCount]=$.fn.stripScript($(this).find("note").text())),"quiz"===topicSrc[topicCount]){var e=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("question").text()),i=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").find("question").attr("img")),s=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").find("question").attr("audio")),o=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("choice").text()),n=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").find("choice").attr("useImg")),a=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("wrongFeedback").text()),r=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("correctFeedback").text()),l=$.trim(t.find("topic:eq("+topicCount+")").find("quiz").attr("type")),c=$.fn.stripScript(t.find("topic:eq("+topicCount+")").find("quiz").find("answer").text()),d={};quizDetected=!0,d.id=topicCount,d.type=l,d.question=e,d.img=""!==i?i:"",d.audio=""!==s?s:"",d.choiceImg=""!==n?n:"",o?(d.choice=$.fn.splitSelections(o),d.wrongFeedback=$.fn.splitSelections(a)):d.wrongFeedback=a,d.answer=$.fn.splitSelections(c),d.stuAnswer="",d.correct=!1,d.correctFeedback=r,d.taken=!1,questions.push(d)}++topicCount}),$.fn.setupPlayer()},$.fn.setupPlayer=function(){var e;if(version=void 0===$("#storybook_plus_wrapper").attr("data-version")?"":$("#storybook_plus_wrapper").attr("data-version").replace(/\./g,""),$(document).attr("title",lessonTitle),$("#errorMsg").hide(),$.each(topicSrc,function(e){var t=topicSrc[e].substring(0,topicSrc[e].indexOf(":")+1);return"video:"!==t&&"youtube:"!==t&&"vimeo:"!==t&&"kaltura:"!==t?(media="Slide",!1):void(media="Video")}),enabledNote===!1&&quizDetected===!1&&230>version)$("#storybook_plus_wrapper").addClass("noteDisabled");else if(enabledNote===!1&&quizDetected===!0||version>=230){var t=$.fn.getProgramDirectory(),i='<img src="'+ROOT_PATH+'img/uw_ex_ceoel_logo.svg" width="250" height="108" alt="University of Wisconsin-Extension Division of Continuing Education, Outreach &amp; E-Learning" border="0" />';switch($("#storybook_plus_wrapper").addClass("withQuiz"),t){case"smgt":case"msmgt":i='<img src="'+ROOT_PATH+'img/uw_smgt_logo.svg" width="250" height="108" alt="University of Wisconsin Sustainable Management" border="0" />';break;case"hwm":i='<img src="'+ROOT_PATH+'img/uw_hwm_logo.svg" width="250" height="108" alt="University of Wisconsin Health &amp; Wellness Management" border="0" />';break;case"himt":i='<img src="'+ROOT_PATH+'img/uw_himt_logo.svg" width="250" height="108" alt="University of Wisconsin Health Information Management &amp; Technology" border="0" />';break;case"il":i='<img src="'+ROOT_PATH+'img/uw_il_logo.svg" width="250" height="108" alt="University of Wisconsin Independent Learning" border="0" />';break;case"flx":i='<img src="'+ROOT_PATH+'img/uw_flx_logo.svg" width="250" height="108" alt="University of Wisconsin Flexible Option" border="0" />';break;case"bps":i='<img src="'+ROOT_PATH+'img/uw_bps_logo.svg" width="250" height="108" alt="University of Wisconsin Bachelor of Professional Studies in Organization Leadership and Communication" border="0" />'}enabledNote===!1&&$("#note").addClass("noNotes").html('<div class="logo">'+i+"</div>")}$("#selectable").before('<div class="toc_heading">Table of Contents</div>'),$.each(topicTitle,function(t){e="quiz"===topicSrc[t]?' <span class="icon-assessement light"></span>':"",$("#selectable").append('<li class="ui-widget-content" title="'+topicTitle[t]+'"><div class="slideNum">'+$.fn.addLeadingZero(t+1)+'.</div><div class="title">'+topicTitle[t]+e+"</div></li>")}),$("#splash_screen").css("background-image","url(assets/splash.jpg)"),$("#splash_screen").append("<p>"+lessonTitle+"</p><p>"+instructor+"</p>"+(0!==duration?"<p><small>"+duration+"</small></p>":"")+'<a class="playBtn" href="#"></a>'),$("#splash_screen, #playBtn").on("click",function(){return $.fn.initializePlayer(),!1}),$.fn.getDownloadableFiles()},$.fn.initializePlayer=function(){$("#splash_screen").hide(),$("#lessonTitle").attr("title",lessonTitle),$("#lessonTitle").html(lessonTitle),$("#instructorName").html('<a class="instructorName" href="#">'+instructor+"</a>"),$("#profile .photo").before('<div class="profileCloseBtn"><a id="profileClose" href="#">&times;</a></div>'),$("#profile .bio").html("<h2>"+instructor+"</h2>"+PROFILE),"Video"!==media&&$("#player").append('<div id="progressing"></div>'),$("#info, a.instructorName, #profileClose").on("click",function(){return $("#profile").is(":visible")?$("#profile").fadeOut(300):$("#profile").fadeIn(300),!1}),$("#selectable li:first").addClass("ui-selected"),$("#selectable").selectable(),$("#selectable").selectable("option","appendTo","#toc"),$("#selectable").on("selectablestop",function(){tocIndex=Number($(".ui-selected .slideNum").html().replace(".",""))-1,tocIndex!==previousIndex&&($.fn.loadSlide(topicSrc[tocIndex],tocIndex),previousIndex=tocIndex)}),$("#selectable").on("selectableselected",function(){$.fn.autoscroll()}),$("#leftBtn").on("click",function(){return counter--,0>counter&&(counter=topicCount-1),$.fn.loadSlide(topicSrc[counter],counter),previousIndex=counter,$.fn.autoscroll(),!1}),$("#rightBtn").on("click",function(){return counter++,counter>topicCount-1&&(counter=0),$.fn.loadSlide(topicSrc[counter],counter),previousIndex=counter,$.fn.autoscroll(),!1}),(enabledNote===!0||quizDetected===!0||version>=230)&&($("#control").append('<span id="magnifyBtn"><span class="icon-expand" title="Expand"></span></span>'),$("#magnifyBtn").before($("#storybook_plus_wrapper").hasClass("withQuiz")?'<span id="tocBtn"><span class="toc" title="Toggle Table of Contents"></span></span>':'<span id="notesBtn"><span class="notes" title="Toggle Notes"></span></span><span id="tocBtn"><span class="toc" title="Toggle Table of Contents"></span></span>'),$.fn.bindImgMagnify(),$.fn.bindNoteSlideToggle(),$.fn.bindTocSlideToggle()),$.fn.loadSlide(topicSrc[0],counter),$.fn.loadProfilePhoto(),$("#player").show()},$.fn.autoscroll=function(){var e=$(".ui-selected").position().top,t=$("#selectable").height();e>=t?$("#selectable").animate({scrollTop:t/2},1e3):e<$("#selectable").scrollTop()/6&&$("#selectable").animate({scrollTop:0},1e3)},$.fn.loadSlide=function(e,t){var i,s=e.substring(e.indexOf(":")+1);if("quiz"!==e&&(e=e.substring(0,e.indexOf(":")+1)),"video:"!==e&&"kaltura:"!==e&&"youtube:"!==e&&"vimeo:"!==e&&$("#progressing").fadeIn(),$("#slideNote").hasClass("quizSlide")&&$("#slideNote").removeClass("quizSlide"),null!==videoPlayer&&($(".vjs-control").blur(),$(".vjs-menu-item").blur(),videoPlayer.dispose(),videoPlayer=null,$("#vp").empty().hide()),audioPlaying){try{audioPlayer.pause()}catch(o){}$("#ap").hide(),audioPlaying=!1}switch($("#slide").html(""),e){case"image:":i=new Image,s=s.toLowerCase(),imgPath="assets/slides/"+s+"."+slideImgFormat,imgCaption=$("#selectable li .title").get(t).innerHTML,$(i).load(function(){$(this).hide(),$("#slide").html('<div id="img"></div>'),$("#slide #img").html(i),$(this).fadeIn()}).error(function(){$.fn.displayErrorMsg("image not found!","Expected image: "+imgPath)}).attr({src:imgPath,border:0});break;case"image-audio:":i=new Image,s=s.toLowerCase(),imgPath="assets/slides/"+s+"."+slideImgFormat,imgCaption=$("#selectable li .title").get(t).innerHTML,$(i).load(function(){$(this).hide(),$("#slide").html('<div id="img"></div>'),$("#slide #img").html(i),$(this).fadeIn(),audioPlaying||$.ajax({url:"assets/audio/"+s+".mp3",type:"HEAD",error:function(){$.fn.displayErrorMsg("audio file not found!","Expected file: assets/audio/"+s+".mp3")},success:function(){$("#ap").show(),firstAudioLoad!==!0?($.fn.loadAudioPlayer("#apc",s),firstAudioLoad=!0):(sources=[{src:"assets/audio/"+s+".mp3",type:"audio/mpeg"}],audioPlayer.setSrc(sources)),audioPlaying=!0}})}).error(function(){$.fn.displayErrorMsg("image not found!","Expected image: "+imgPath)}).attr({src:imgPath,border:0});break;case"video:":s=s.toLowerCase(),$.fn.setupVideoPlayer("video",s);break;case"youtube:":$("#slide").html('<iframe width="640" height="360" src="https://www.youtube.com/embed/'+s+'?modestbranding=1&theme=light&color=white&showinfo=0&autoplay=1&controls=2&fs=0&html5=1&autohide=1&rel=0&iv_load_policy=3" frameborder="0"></iframe>').promise().done();break;case"vimeo:":$("#slide").html('<iframe width="640" height="360" src="//player.vimeo.com/video/'+s+'?portrait=0&color=ffffff&autoplay=1&fullscreen=0" frameborder="0"></iframe>').promise().done();break;case"kaltura:":$.fn.setupVideoPlayer("kaltura",s);break;case"swf:":s=s.toLowerCase(),$("#slide").html('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+s+'.swf"><param name="movie" value="assets/swf/'+s+'.swf" /><div id="errorMsg"><p>Error: Adobe Flash Player is not enabled or installed!</p><p>Adobe Flash Player is required to view this slide. Please enable or <a href="http://get.adobe.com/flashplayer/" target="_blank">install Adobe Flash Player</a>.</p></div></object>').promise().done(function(){});break;case"quiz":$("#slideNote").addClass("quizSlide"),$.fn.setupQuiz(t);break;default:$.fn.displayErrorMsg("unknow slide type!","Please double check the XML file.")}enabledNote&&$(this).loadNote(t),$(this).updateSlideNum(t),$("#progressing").length&&$("#progressing").promise().done(function(){$(this).fadeOut()})},$.fn.setupVideoPlayer=function(e,t){var i="vpc";switch(e){case"video":var s="";$.get("assets/video/"+t+".vtt",function(){s='<track kind="subtitles" src="assets/video/'+t+'.vtt" srclang="en" label="English">'}).always(function(){var e='<source src="assets/video/'+t+'.mp4" type="video/mp4" />';$("#vp").html('<video id="'+i+'" class="video-js vjs-default-skin">'+e+s+"</video>").promise().done(function(){$.fn.loadVideoJsPlayer(i,t)})});break;case"kaltura":0===kalturaLoaded?$.getScript("../sources/scripts/mwembedloader.js",function(){$.getScript("../sources/scripts/kwidgetgetsources.js",function(){$.fn.requestKalturaAPI(i,t),kalturaLoaded=1})}):$.fn.requestKalturaAPI(i,t);break;default:$.fn.displayErrorMsg("Video error!","Please double check your XML file.")}},$.fn.requestKalturaAPI=function(e,t){var i,s,o,n,a={},r;kWidget.getSources({partnerId:1660872,entryId:t,callback:function(t){i=t.entryId,s=t.captionId,o=t.captionExt,n=t.captionLang;for(var l in t.sources){var c=t.sources[l];487061===c.flavorParamsId&&(a.low=c.src),487071===c.flavorParamsId&&(a.normal=c.src),487081===c.flavorParamsId&&(a.high=c.src),487111===c.flavorParamsId&&(a.webm=c.src)}r='<video id="'+e+'" class="video-js vjs-default-skin">',void 0!==a.low&&(r+='<source src="'+a.low+'" type="video/mp4" data-res="low" />'),r+='<source src="'+a.normal+'" type="video/mp4" data-res="normal" data-default="true" />',void 0!==a.low&&(r+='<source src="'+a.high+'" type="video/mp4" data-res="high" />'),void 0!==a.webm&&$.fn.supportWebm()&&(r+='<source src="'+a.webm+'" type="video/webm" />'),null!==s&&(r+='<track kind="subtitles" src="https://cdnapisec.kaltura.com/api_v3/index.php/service/caption_captionAsset/action/serve/captionAssetId/'+s+'" srclang="en" label="English">'),r+="</video>",$("#vp").html(r),$.fn.loadVideoJsPlayer(e)}})},$.fn.loadVideoJsPlayer=function(e){var t={techOrder:["html5","flash"],width:640,height:360,controls:!0,autoplay:!0,preload:"auto",plugins:{resolutionSelector:{default_res:"normal"}}};$.fn.supportMp4()===!1&&$.fn.supportWebm()===!1&&(t.techOrder=["flash","html5"],t.plugins=null),$("#vp").fadeIn(),videojs(e,t,function(){videoPlayer=this,this.progressTips(),this.removeChild("FullscreenToggle")}),videojs.options.flash.swf=ROOT_PATH+"videoplayer/video-js.swf"},$.fn.setupQuiz=function(e){for(var t=0,i=!1;!i||t>=questions.length;)questions[t].id===e?i=!0:t++;if($("#slide").html('<div id="quiz"><div class="header"><span class="icon-assessement"></span> Self-Assessment</div>'),questions[t].taken)$.fn.showFeedback(t);else if(""!==questions[t].img){var s=new Image;imgPath="assets/img/"+questions[t].img,$(s).load(function(){$("#quiz").append('<div class="question">'+questions[t].question+"</div>"),$(".question").append(s);var e="";""!==questions[t].audio&&(e='<audio controls><source src="assets/audio/'+questions[t].audio+'.mp3" type="audio/mpeg" /></audio>',$("#quiz").append(e)),$.fn.displayAnswerChoices(t)}).error(function(){$.fn.displayErrorMsg("image not found!","Expected image: "+imgPath)}).attr({src:imgPath,alt:questions[t].question,border:0})}else{var o="";""!==questions[t].audio&&(o='<audio controls><source src="assets/audio/'+questions[t].audio+'.mp3" type="audio/mpeg" /></audio>'),$("#quiz").append('<div class="question">'+questions[t].question+o+"</div>"),$.fn.displayAnswerChoices(t)}},$.fn.displayAnswerChoices=function(e){var t,i=!1;switch(questions[e].type){case"t/f":$("#quiz").append('<div class="answerArea"><label for="t"><input id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input type="radio" id="f" name="tf" value="false" /> False</label></div>');break;case"fib":$("#quiz").append('<div class="answerArea"><input type="text" id="saAns" /></div>');break;case"mc":var s="radio",o="mc";if(t=questions[e].answer.length,$("#quiz").append('<div class="answerArea">'),t>1&&(s="checkbox",o="ma"),"true"===questions[e].choiceImg)for(var n=0;n<questions[e].choice.length;n++)$(".answerArea").append('<label class="img_choice"for="'+n+'"><input id="'+n+'" type="'+s+'" name="'+o+'" value="'+questions[e].choice[n]+'" /> <img src="assets/img/'+questions[e].choice[n]+'" /></label>');else for(var a=0;a<questions[e].choice.length;a++)$(".answerArea").append('<label for="'+a+'"><input id="'+a+'" type="'+s+'" name="'+o+'" value="'+questions[e].choice[a]+'" /> '+questions[e].choice[a]+"</label>");$("#quiz").append("</div>");break;case"sa":$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>');break;default:i=!0,$.fn.displayErrorMsg("unknow question type!","Please double check the topic XML file.")}i||($("#quiz").append('<div class="submitArea"><a id="check" rel="'+e+'" href="#">SUBMIT</a></div>'),$("#slide").append("</div>"),$("#quiz").hide().fadeIn(),$("#check").on("click",function(){var e=Number($(this).attr("rel")),i;switch(questions[e].type){case"t/f":i=$("input:radio[name=tf]:checked").val(),void 0===i&&(i="");break;case"fib":i=$.trim($("#saAns").val());break;case"mc":t>1?(i=[],$("input:checkbox[name=ma]:checked").each(function(){i.push($(this).val())}),questions[e].incorrectIndex=0):(i=$("input:radio[name=mc]:checked").val(),questions[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked"))),(void 0===i||i.length<=0)&&(i="");break;case"sa":i=$.trim($("#saAns").val());break;default:i=""}if(""!==i){switch(questions[e].type){case"fib":for(var s=0;s<questions[e].answer.length;s++)if(i.toLowerCase()===questions[e].answer[s].toLowerCase()){questions[e].correct=!0;break}break;case"t/f":questions[e].correct=i===String(questions[e].answer)?!0:!1;break;case"mc":var o=0;if(t>1){for(o=0;o<i.length;o++){if(!($.inArray(i[o],questions[e].answer)>=0)){questions[e].correct=!1;break}questions[e].correct=!0}o<questions[e].answer.length&&(questions[e].correct=!1)}else questions[e].correct=i===questions[e].answer[0]?!0:!1;break;default:questions[e].correct=!1}questions[e].stuAnswer=i,questions[e].taken=!0,$.fn.showFeedback(e)}else $(".question").before('<p class="quizIncorrect"><span class="icon-notification"></span> Please answer the question before submitting!</p>'),$(".quizIncorrect").delay(6e3).slideUp("slow",function(){$(".question").prev().remove()});return!1}))},$.fn.showFeedback=function(e){var t="",i="";if($("#slide").html('<div id="quiz"><div class="header"><span class="icon-assessement"></span> Self-Assessment Feedback</div>'),"sa"!==questions[e].type&&$("#quiz").append(questions[e].correct?'<p class="quizCorrect"><span class="icon-checkmark"></span> CORRECT</p>':'<p class="quizIncorrect"><span class="icon-notification"></span> INCORRECT</p>'),""!==questions[e].img&&(t='<img src="assets/img/'+questions[e].img+'" alt="'+questions[e].question+'" border="0" />'),""!==questions[e].audio&&(i='<audio controls><source src="assets/audio/'+questions[e].audio+'.mp3" type="audio/mpeg" /></audio>'),$("#quiz").append('<div class="question">'+questions[e].question+t+i+"</div>"),"true"===questions[e].choiceImg?($("#quiz").append('<div class="result"><p><strong>Your answer</strong>:<br />'+$.fn.parseArrayImg(questions[e].stuAnswer)+"</p></div>"),$(".result").append("<p><strong>Correct answer</strong>:<br />"+$.fn.parseArrayImg(questions[e].answer)+"</p>")):($("#quiz").append('<div class="result"><p><strong>Your answer</strong>: '+$.fn.parseArray(questions[e].stuAnswer)+"</p></div>"),$(".result").append("<p><strong>Correct answer</strong>: "+$.fn.parseArray(questions[e].answer)+"</p>")),"sa"!==questions[e].type)if(questions[e].correct)""!==String(questions[e].correctFeedback)&&$(".result").append("<p><strong>Feedback:</strong> "+questions[e].correctFeedback+"</p>");else if("mc"===questions[e].type){var s=questions[e].wrongFeedback[questions[e].incorrectIndex];void 0===s&&(s=questions[e].wrongFeedback),""!==String(s)&&$(".result").append("<p><strong>Feedback:</strong> "+s+"</p>")}else""!==String(questions[e].wrongFeedback)&&$(".result").append("<p><strong>Feedback:</strong> "+questions[e].wrongFeedback+"</p>")},$.fn.loadAudioPlayer=function(e,t){var i="100%",s=30;audioPlayer=new MediaElementPlayer(e,{audioWidth:i,audioHeight:s,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(e){sources=[{src:"assets/audio/"+t+".mp3",type:"audio/mpeg"}],e.setSrc(sources),e.load(),e.addEventListener("play",function(){$.fn.bindAudioPlayerFadeInOut()}),e.addEventListener("ended",function(){$.fn.unbindAudioPlayerFadeInOut()})}})},$.fn.bindAudioPlayerFadeInOut=function(){$("#ap").delay(3e3).fadeOut("slow"),$("#img, #ap").on("mouseenter",function(){$("#ap").stop(!0,!0).fadeIn("slow")}),$("#img, #ap").on("mouseleave",function(){$("#ap").stop(!1,!0).delay(1e3).fadeOut("slow")})},$.fn.unbindAudioPlayerFadeInOut=function(){$("#ap").fadeIn("fast"),$("#img, #ap").unbind("mouseenter"),$("#img, #ap").unbind("mouseleave")},$.fn.loadNote=function(e){var t=noteArray[e];$("#slideNote").hasClass("quizSlide")?$("#notesBtn").hide():($("#note").html(t).hide().fadeIn("fast"),$("#storybook_plus_wrapper").hasClass("magnified")&&$("#notesBtn").show()),$("#note").find("a").length&&$("#note a").each(function(){$(this).attr("target","_blank")})},$.fn.updateSlideNum=function(e){var t=e+1;counter=e,$("#selectable li").each(function(){$(this).removeClass("ui-selected")}),$("#selectable li:nth-child("+t+")").addClass("ui-selected"),$("#currentStatus").html(media+" "+t+" of "+topicCount)},$.fn.bindImgMagnify=function(){$("#magnifyBtn").on("click",function(){$("#storybook_plus_wrapper").hasClass("magnified")?($("#storybook_plus_wrapper").removeClass("magnified"),$(this).html('<span class="icon-expand" title="Expand"></span>'),$("#notesBtn, #tocBtn").hide(),$("#toc").css("left",""),$("#tocBtn").hasClass("active")&&$("#tocBtn").removeClass("active")):($("#storybook_plus_wrapper").addClass("magnified"),$(this).html('<span class="icon-contract" title="Contract"></span>'),$("#tocBtn").show(),$("#slideNote").hasClass("quizSlide")||$("#notesBtn").show())})},$.fn.bindNoteSlideToggle=function(){var e=$("#note"),t=360,i=536;$("#notesBtn").on("click",function(){var s=Math.ceil(e.offset().top),o=0;s>=i?(o=t,$(this).addClass("active")):(o=i,$(this).removeClass("active")),$("#toc").offset().left<=642&&($("#toc").animate({left:900}),$("#tocBtn").removeClass("active")),e.animate({top:o})})},$.fn.bindTocSlideToggle=function(){var e=$("#toc"),t=642,i=900;$("#tocBtn").on("click",function(){var s=Math.ceil(e.offset().left),o=0;s>=i?(o=t,$(this).addClass("active")):(o=i,$(this).removeClass("active")),$("#note").offset().top>=360&&($("#note").animate({top:536}),$("#notesBtn").removeClass("active")),e.animate({left:o})})},$.fn.loadProfilePhoto=function(){var e=new Image,t="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img src="'+t+'" alt="Instructor Photo" border="0" />')}).error(function(){$("#profile .photo").html('<img src="'+ROOT_PATH+'img/profile.png" width="200" height="300" alt="No Profile Photo" border="0" />')}).attr({src:t,border:0})},$.fn.getDownloadableFiles=function(){var e=$.fn.getDirectory(),t=$("#download_bar ul"),i=window.location.href;i=i.substr(0,i.lastIndexOf("/")+1)+e,$.get(i+".pdf",function(){t.append('<li><a download href="'+i+'.pdf" target="_blank"><span class="icon-arrow-down"><span> Transcript</a></li>')}).always(function(){$.get(i+".mp3",function(){t.append('<li><a download href="'+i+'.mp3" target="_blank"><span class="icon-arrow-down"><span> Audio</a></li>')}).always(function(){$.get(i+".zip",function(){t.append('<li><a href="'+i+'.zip" target="_blank"><span class="icon-arrow-down"><span> Supplement</a></li>')})})})},$.fn.displayGetLessonError=function(e,t){var i,s;switch(e){case 0:i="<strong>Error 0</strong> - Not connect. Please verify network.";break;case 200:i="<strong>Error 200</strong> - Invalid characters in XML.";break;case 404:i="<strong>Error 404</strong> - Requested page not found.";break;case 406:i="<strong>Error 406</strong> - Not acceptable error.";break;case 500:i="<strong>Error 500</strong> - Internal Server Error.";break;default:i="Unknow error ... "+e}switch(t){case"parsererror":s="XML parse failed. Please double-check the <strong>topic.xml</strong> file in the <strong>assets</strong> directory. All node values must be wrapped inside <code>&lt;![CDATA[ ... ]]&gt;</code> or use HTML entity for special characters.";break;case"timeout":s="XML parsing timed out. It is taking too long for the browser.";break;case"abort":s="Ajax request aborted.";break;case"error":s="Failed to get requested source. Most likely a 404 or 406.";break;default:s="Uncaught Error ... "+e.responseText}$("#splash_screen, #player").hide(),$("#errorMsg").html("<p>"+i+"</p><p>"+s+"</p>")},$.fn.splitSelections=function(e){var t=e.split("|");return t},$.fn.displayErrorMsg=function(e,t){$("#slide").html('<div id="errorMsg"><p><strong>Error:</strong> '+e+"</p><p>"+t+"</p></div>")},$.fn.getDirectory=function(){var e=window.location.href,t;return t=e.split("?"),t=t[0].split("/"),t=t[t.length-2]},$.fn.getParameterByName=function(e){var t="[\\?&]"+e+"=([^&#]*)",i=new RegExp(t),s=i.exec(window.location.href);return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===s?"":decodeURIComponent(s[1].replace(/\+/g," "))},$.fn.addLeadingZero=function(e){return 10>e?"0"+e:e},$.fn.parseArray=function(e){var t="";if($.isArray(e))for(var i=0;i<e.length;i++)t+=1===e.length?e[0]:i===e.length-1?e[i]:e[i]+", ";else t=e;return t},$.fn.parseArrayImg=function(e){var t="";if($.isArray(e))for(var i=0;i<e.length;i++)t+='<img src="assets/img/'+e[i]+'" /> ';else t='<img src="assets/img/'+e+'" /> ';return t},$.fn.stripScript=function(e){if(""!==e||void 0!==e){var t=$("<span>"+$.trim(e)+"</span>");return t.find("script,noscript,style").remove().end(),t.html()}return e},$.fn.supportWebm=function(){return!!document.createElement("video").canPlayType('video/webm; codecs="vp8.0, vorbis"')},$.fn.supportMp4=function(){return!!document.createElement("video").canPlayType('video/mp4; codecs="avc1.4D401E, mp4a.40.2"')},$.fn.getProgramDirectory=function(){var e=window.location.href.split("/");return void 0===e[4]?"":e[4]};