/* global console *//* global videojs *//* global MediaElementPlayer *//* global alert */$(document).load(function(){$("noscript").hide()});$(document).ready(function(){function t(e){var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}function H(e){var t=$(e).find("setup"),n=$(e).find("topic"),r=$(e).find("profile").text(),i=t.find("lesson").text().length<=0?"Lesson name is not specified":t.find("lesson").text(),s=t.find("instructor").text().length<=0?"Instructor is not specified":'<a class="instructorP" href="#profile">'+t.find("instructor").text()+"</a>",o=t.find("length").text().length<=0?"":t.find("length").text();A=t.find("note").text().length<=0?!1:t.find("note").text();A==="yes"||A==="y"?A=!0:A=!1;if(!A){$("#note").hide();$("#fontMinusBtn").hide();$("#fontPlusBtn").hide();$("#fontSizeIndicator").hide();$("#toc").css("height","399px")}C=t.find("slideImgFormat").text().length<=0?"png":t.find("slideImgFormat").text();T=$(e);$("#lessonTitle").html(i);$("#instructorName").html(s);$("#profile .bio").html("<p>"+t.find("instructor").text()+"</p>"+r);N=[];_=[];n.each(function(){var e=$(this).attr("title");N[y]=$(this).attr("src");if(m===!0){$("#selectable").html('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(y+1<10?"0"+(y+1):y+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");m=!1}else $("#selectable").append('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(y+1<10?"0"+(y+1):y+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");if(N[y]==="quiz"){M={};M.id=y;M.type=T.find("topic:eq("+y+")").find("quiz").attr("type");M.question=T.find("topic:eq("+y+")").find("quiz").find("question").text();if(T.find("topic:eq("+y+")").find("quiz").find("choice").text()!==""){M.choice=B(T.find("topic:eq("+y+")").find("quiz").find("choice").text());M.wrongFeedback=B(T.find("topic:eq("+y+")").find("quiz").find("wrongFeedback").text())}else M.wrongFeedback=T.find("topic:eq("+y+")").find("quiz").find("wrongFeedback").text();M.answer=B(T.find("topic:eq("+y+")").find("quiz").find("answer").text());M.stuAnswer="";M.correct=!1;M.correctFeedback=T.find("topic:eq("+y+")").find("quiz").find("correctFeedback").text();M.taken=!1;_.push(M)}y++});$(document).attr("title",i);$("#splash_screen").append("<p>"+i+"</p><p>"+(t.find("instructor").text().length<=0?"Instructor is not specified":t.find("instructor").text())+"</p>"+(o!==0?"<p>"+o+"</p>":"")+'<p><a id="playBtn" href="#">&#9658</button></a>');$("#splash_screen").css("background-image","url(assets/splash.jpg)");A||$("#splash_screen").css({height:"230px","padding-top":"100px","padding-bottom":"100px","padding-right":"200px","padding-left":"200px"});$("#splash_screen, #playBtn").on("click",function(){j(i);$("#splash_screen").hide();return!1});i=i.toLowerCase().replace("-","_").replace(" ","_");V(K(),"mp3");V(K(),"pdf")}function B(e){var t=0,n=[],r=e,i,s;r+="|";s=r.indexOf("|");while(r.indexOf("|")!==-1){i=r.substring(0,s);r=r.substring(s+1);s=r.indexOf("|");n[t]=i;t++}return n}function j(){$("#player").show();jQuery.each(N,function(t){var n=N[t].substring(0,N[t].indexOf(":")+1);if(n!=="video:"&&n!=="youtube:"){e="Slide";return!1}e="Video"});F(N[0],b);$("#selectable li:first").addClass("ui-selected");$("#errorMsg").hide();$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){E=$("#selectable li").index(this)+1});if(E!==w){F(N[E-1],E);w=E}}});q();$("a#info, a.instructorP").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});if(A){$("#fontSizeIndicator").html(a);$("#fontMinusBtn").on("click",function(){a-=2;f-=2;l-=2;c-=2;h-=2;p-=2;d-=2;v-=2;if(a<=12){a=12;f=16}if(d<=16){d=16;v=20}if(h<=18){h=18;p=22}if(l<=20){l=20;c=24}$("#note, #note p").css({"font-size":a,"line-height":f+"px"});$("#note h1").css({"font-size":l,"line-height":p+"px"});$("#note h2").css({"font-size":h,"line-height":p+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":d,"line-height":v+"px"});$("#fontSizeIndicator").html(a)});$("#fontPlusBtn").on("click",function(){a+=2;f+=2;l+=2;c+=2;h+=2;p+=2;d+=2;v+=2;if(a>=28){a=28;f=32}if(d>=30){d=30;v=34}if(h>=32){h=32;p=36}if(l>=34){l=34;c=38}$("#note, #note p").css({"font-size":a,"line-height":f+"px"});$("#note h1").css({"font-size":l,"line-height":c+"px"});$("#note h2").css({"font-size":h,"line-height":p+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":d,"line-height":v+"px"});$("#fontSizeIndicator").html(a)})}$("#leftBtn").on("click",function(){b--;b<=0&&(b=y);F(N[b-1],b)});$("#rightBtn").on("click",function(){b++;b>y&&(b=1);F(N[b-1],b)})}function F(e,t){var n,r,i;t=t<10?"0"+t:t;n=Number(t)-1;r=Number(t)-1;$("#slide").html('<div id="progressing"></div>');$("#progressing").fadeIn();if(x){$("#vp").html("");$("#vp").hide();x=!1}if(S){L.setCurrentTime(0);L.pause();S=!1;if(A){$("#ap").hide();$("#note").height($("#note").height()+30)}else{$("#apm").hide();$("#currentStatus").css("width","76.85%")}}if(e.substring(0,e.indexOf(":")+1)==="image:"){i=new Image;k="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+C;O=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+O+'"href="'+k+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});U(!0)}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+k+"</p><p>Total number of slides: "+y+"</p><p>"+e+"</p>")}).attr({src:k,border:0})}else if(e.substring(0,e.indexOf(":")+1)==="youtube:"){U(!1);$("#slide").append('<iframe width="640" height="360" src="https://www.youtube.com/embed/'+e.substring(e.indexOf(":")+1)+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe>')}else if(e.substring(0,e.indexOf(":")+1)==="video:"){U(!1);var s=$.now();$("#vp").append('<video id="vpc'+s+'" class="video-js vjs-default-skin" controls autoplay preload="none" width="640" height="360" data-setup=\'{"controls":true}\'>'+(J(e.substring(e.indexOf(":")+1))?'<track kind="subtitles" src="assets/video/'+e.substring(e.indexOf(":")+1)+'.vtt" srclang="en" label="English" default>':"")+"</video>");if(!x){$("#vp").show();videojs("vpc"+s,{},function(){this.progressTips();this.src([{type:"video/mp4",src:"assets/video/"+e.substring(e.indexOf(":")+1)+".mp4"},{type:"video/webm",src:"assets/video/"+e.substring(e.indexOf(":")+1)+".webm"}])});videojs.options.flash.swf="sources/videoplayer/video-js.swf";x=!0}}else if(e.substring(0,e.indexOf(":")+1)==="swf:"){U(!1);$("#slide").append('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+e.substring(e.indexOf(":")+1)+'.swf"><param name="movie" value="assets/swf/'+e+'.swf" /><p>Your web browser does not support Adobe Flash.</p></object>')}else if(e.substring(0,e.indexOf(":")+1)==="image-audio:"){i=new Image;k="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+C;O=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+O+'"href="'+k+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});U(!0);if(!S){var t;if(A){$("#ap").show();if(g!==!0){L=new MediaElementPlayer("#apc",{audioWidth:640,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(n){t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];n.setSrc(t);n.load()}});g=!0}else{t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];L.setSrc(t)}$("#note").height($("#note").height()-30)}else{$("#apm").show();if(g!==!0){L=new MediaElementPlayer("#apcm",{audioWidth:300,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(n){t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];n.setSrc(t);n.load()}});g=!0}else{t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];L.setSrc(t)}$("#currentStatus").css("width","30%")}S=!0}}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+k+"</p><p>"+e+"</p>")}).attr({src:k,border:0})}else if(e==="quiz")try{z(n)}catch(o){console.append("<li>"+o+"</li>")}else $("#slide").html("<p>ERROR!</p>");I(r);R(t);$("#progressing").hide()}function I(e){var t=T.find("topic:eq("+e+")").find("note").text();$("#note").html(t);$("#note").find("a").length&&$("#note a").each(function(){$(this).attr("target","_blank")})}function q(){var e=new Image,t="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img src="'+t+'" alt="Instructor Photo" border="0" />')}).error(function(){$("#profile .photo").html('<img src="assets/img/profile.png" width="200" height="300" alt="No Profile Photo" border="0" />')}).attr({src:t,border:0})}function R(t){b=t;$("#selectable li").each(function(){$(this).removeClass("ui-selected")});$("#selectable li:nth-child("+Number(t)+")").addClass("ui-selected");$("#currentStatus").html(e+" "+t+" of "+(y<10?"0"+y:y))}function U(e){if(e){$("a#img, #magnifyIcon").on("mouseenter",function(){$("#magnifyIcon").show()});$("a#img, #magnifyIcon").on("mouseleave",function(){$("#magnifyIcon").hide()});$("#magnifyIcon").on("click",function(){$.fancybox.open({href:k,title:O,helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0})})}}function z(e){while(!D||P===_.length)_[P].id===e?D=!0:P++;$("#slide").append('<div id="quiz"><div class="header">Quiz '+(P+1)+" of "+_.length+"</div>");$("#quiz").hide();$("#quiz").fadeIn();if(!_[P].taken){$("#quiz").append('<div class="question">'+_[P].question+"</div>");if(_[P].type==="t/f")$("#quiz").append('<div class="answerArea"><label for="t"><input id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input type="radio" id="f" name="tf" value="false" /> False</label></div>');else if(_[P].type==="fib")$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>');else if(_[P].type==="mc"){$("#quiz").append('<div class="answerArea">');for(var t=0;t<_[P].choice.length;t++)$(".answerArea").append('<label for="'+t+'"><input id="'+t+'" type="radio" name="mc" value="'+_[P].choice[t]+'" /> '+_[P].choice[t]+"</label>");$("#quiz").append("</div>")}else _[P].type==="sa"?$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>'):$("#quiz").append('<div class="answerArea">ERROR!</div>');$("#quiz").append('<div class="submitArea"><button id="check" rel="'+P+'">SUBMIT</button></div>');$("#check").click(function(){var e=Number($(this).attr("rel")),t;if(_[e].type==="t/f"){t=$("input:radio[name=tf]:checked").val();t===undefined&&(t="")}else if(_[e].type==="fib")t=$.trim($("#saAns").val());else if(_[e].type==="mc"){t=$("input:radio[name=mc]:checked").val();_[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked"));t===undefined&&(t="")}else _[e].type==="sa"?t=$.trim($("#saAns").val()):$.trim(t);if(t!==""){for(var n=0;n<_[e].answer.length;n++)if(_[e].type==="fib"){var r=0;for(r;r<_[e].answer.length;r++)if(t.toLowerCase()===_[e].answer[r].toLowerCase()){_[e].correct=!0;break}}else _[e].type==="t/f"?t.toLowerCase()===_[e].answer[n].toLowerCase()?_[e].correct=!0:_[e].correct=!1:_[e].type==="mc"&&(t.toLowerCase()===_[e].answer[n].toLowerCase()?_[e].correct=!0:_[e].correct=!1);_[e].stuAnswer=t;_[e].taken=!0;W(e)}else alert("Please answer the question before submitting.")})}else W(P);$("#slide").append("</div>");P=0;D=!1}function W(e){var t="";$("#slide").html('<div id="quiz"><div class="header">Quiz '+(e+1)+" of "+_.length+" Feedback</div>");_[e].type!=="sa"&&(_[e].correct?$("#quiz").append('<p class="quizCorrect">Correct!</p>'):$("#quiz").append('<p class="quizIncorrect">Incorrect!</p>'));$("#quiz").append('<div class="question">'+_[e].question+"</div>");$("#quiz").append('<div class="feedback"><p><strong>Your answer</strong>: '+_[e].stuAnswer+"</p>");for(var n=0;n<_[e].answer.length;n++)n===_[e].answer.length-1?t+=_[e].answer[n]:t+=_[e].answer[n]+", ";$(".feedback").append("<p><strong>Correct answer</strong>: "+t+"</p></div>");if(_[e].type!=="sa")if(_[e].correct)$(".feedback").append("<p><strong>Feedback:</strong> "+_[e].correctFeedback+"</p>");else if(_[e].type==="mc"){var r=_[e].wrongFeedback[_[e].incorrectIndex];typeof r=="undefined"&&(r="");$(".feedback").append("<p><strong>Feedback:</strong> "+r+"</p>")}else $(".feedback").append("<p><strong>Feedback:</strong> "+_[e].wrongFeedback+"</p>")}function X(e,t){var n,r;e===0?n="<strong>Error 0</strong> - Not connect. Please verify network.":e===404?n="<strong>Error 404</strong> - Requested page not found.":e===406?n="<strong>Error 406</strong> - Not acceptable error.":e===500?n="<strong>Error 500</strong> - Internal Server Error.":n="Unknow error";t==="parsererror"?r="Requested XML parse failed.":t==="timeout"?r="Time out error.":t==="abort"?r="Ajax request aborted.":t==="error"?r="HTTP / URL Error (most likely a 404 or 406).":r="Uncaught Error.\n"+e.responseText;$("#player").hide();$("#errorMsg").html("<p>"+n+"<br />"+r+"</p>")}function V(e,t){var n;t==="pdf"?n="application/pdf":n="audio/mpeg";$.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:n,async:!1,beforeSend:function(e){e.overrideMimeType(n);e.setRequestHeader("Accept",n)},success:function(){var n=e,r=$("#download_bar ul"),i=window.location.protocol;if(i!=="http:"){var s=window.location.href;s=s.substr(0,s.lastIndexOf("/")+1).replace("https","http");n=s+e}t==="pdf"?r.append('<li><a href="'+n+"."+t+'" target="_blank">Transcript</a></li>'):t==="mp3"&&r.append('<li><a href="'+n+"."+t+'" target="_blank">Audio</a></li>')},error:function(){}})}function J(e){var t=!1;$.ajax({url:"assets/video/"+e+".vtt",type:"HEAD",dataType:"text",contentType:"text/vtt",async:!1,beforeSend:function(e){e.overrideMimeType("text/vtt");e.setRequestHeader("Accept","text/vtt")},success:function(){t=!0},error:function(){t=!1}});return t}function K(){var e=window.location.href,t;t=e.split("?");t=t[0].split("/");t=t[t.length-2];return t}var e="Slide",n=navigator.userAgent,r={iphone:n.match(/(iPhone|iPod|iPad)/),blackberry:n.match(/BlackBerry/),android:n.match(/Android/)},i=t("m")==="0"?!1:!0;if((r.iphone||r.ipod||r.ipad||r.blackberry||r.android)&&i){var s=window.location.href,o,u=s.indexOf(".");o=s.substr(u);s="http://webstreamer"+o+"?m=0";$("#player").hide();$("body").html('<div style="text-align:center; width:450px; height:315px;"><a href="'+s+'" target="_blank"><img src="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/img/view_on_full_site.png" width="450px" height="315px" alt="Launch Presentation in New Window" border="0" /></a></div>')}else{var a=14,f=18,l=22,c=26,h=20,p=24,d=18,v=22,m=!0,g=!1,y=0,b=1,w=0,E=0,S=!1,x=!1,T,N,C,k,L,A=!1,O,M,_,D=!1,P=0;$.ajaxSetup({url:"assets/topic.xml",type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1});$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8");e.setRequestHeader("Accept","text/xml")},success:function(e){H(e)},error:function(e,t){X(e.status,t)}})}});