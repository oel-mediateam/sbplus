/* global console *//* global videojs *//* global MediaElementPlayer *//* global alert */$(document).load(function(){$("noscript").hide()});$(document).ready(function(){function e(e){var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}function P(e){var t=$(e).find("setup"),n=$(e).find("topic"),r=$(e).find("profile").text(),i=t.find("lesson").text().length<=0?"Lesson name is not specified":t.find("lesson").text(),s=t.find("instructor").text().length<=0?"Instructor is not specified":'<a class="instructorP" href="#profile">'+t.find("instructor").text()+"</a>",o=t.find("length").text().length<=0?"":t.find("length").text();L=t.find("note").text().length<=0?!1:t.find("note").text();L==="yes"||L==="y"?L=!0:L=!1;if(!L){$("#note").hide();$("#fontMinusBtn").hide();$("#fontPlusBtn").hide();$("#fontSizeIndicator").hide();$("#toc").css("height","399px")}N=t.find("slideImgFormat").text().length<=0?"png":t.find("slideImgFormat").text();x=$(e);$("#lessonTitle").html(i);$("#instructorName").html(s);$("#profile .bio").html("<p>"+t.find("instructor").text()+"</p>"+r);T=[];M=[];n.each(function(){var e=$(this).attr("title");T[g]=$(this).attr("src");if(v===!0){$("#selectable").html('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(g+1<10?"0"+(g+1):g+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");v=!1}else $("#selectable").append('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(g+1<10?"0"+(g+1):g+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");if(T[g]==="quiz"){O={};O.id=g;O.type=x.find("topic:eq("+g+")").find("quiz").attr("type");O.question=x.find("topic:eq("+g+")").find("quiz").find("question").text();if(x.find("topic:eq("+g+")").find("quiz").find("choice").text()!==""){O.choice=H(x.find("topic:eq("+g+")").find("quiz").find("choice").text());O.wrongFeedback=H(x.find("topic:eq("+g+")").find("quiz").find("wrongFeedback").text())}else O.wrongFeedback=x.find("topic:eq("+g+")").find("quiz").find("wrongFeedback").text();O.answer=H(x.find("topic:eq("+g+")").find("quiz").find("answer").text());O.stuAnswer="";O.correct=!1;O.correctFeedback=x.find("topic:eq("+g+")").find("quiz").find("correctFeedback").text();O.taken=!1;M.push(O)}g++});$(document).attr("title",i);$("#splash_screen").append("<p>"+i+"</p><p>"+(t.find("instructor").text().length<=0?"Instructor is not specified":t.find("instructor").text())+"</p>"+(o!==0?"<p>"+o+"</p>":"")+'<p><a id="playBtn" href="#">&#9658</button></a>');$("#splash_screen").css("background-image","url(assets/splash.jpg)");L||$("#splash_screen").css({height:"230px","padding-top":"100px","padding-bottom":"100px","padding-right":"200px","padding-left":"200px"});$("#splash_screen, #playBtn").on("click",function(){B(i);$("#splash_screen").hide();return!1});i=i.toLowerCase().replace("-","_").replace(/\s+/g,"");X(i,"mp3");X(i,"pdf")}function H(e){var t=0,n=[],r=e,i,s;r+="|";s=r.indexOf("|");while(r.indexOf("|")!==-1){i=r.substring(0,s);r=r.substring(s+1);s=r.indexOf("|");n[t]=i;t++}return n}function B(){$("#player").show();j(T[0],y);$("#selectable li:first").addClass("ui-selected");$("#errorMsg").hide();$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){w=$("#selectable li").index(this)+1});if(w!==b){j(T[w-1],w);b=w}}});I();$("a#info, a.instructorP").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});if(L){$("#fontSizeIndicator").html(u);$("#fontMinusBtn").on("click",function(){u-=2;a-=2;f-=2;l-=2;c-=2;h-=2;p-=2;d-=2;if(u<=12){u=12;a=16}if(p<=16){p=16;d=20}if(c<=18){c=18;h=22}if(f<=20){f=20;l=24}$("#note, #note p").css({"font-size":u,"line-height":a+"px"});$("#note h1").css({"font-size":f,"line-height":h+"px"});$("#note h2").css({"font-size":c,"line-height":h+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":p,"line-height":d+"px"});$("#fontSizeIndicator").html(u)});$("#fontPlusBtn").on("click",function(){u+=2;a+=2;f+=2;l+=2;c+=2;h+=2;p+=2;d+=2;if(u>=28){u=28;a=32}if(p>=30){p=30;d=34}if(c>=32){c=32;h=36}if(f>=34){f=34;l=38}$("#note, #note p").css({"font-size":u,"line-height":a+"px"});$("#note h1").css({"font-size":f,"line-height":l+"px"});$("#note h2").css({"font-size":c,"line-height":h+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":p,"line-height":d+"px"});$("#fontSizeIndicator").html(u)})}$("#leftBtn").on("click",function(){y--;y<=0&&(y=g);j(T[y-1],y)});$("#rightBtn").on("click",function(){y++;y>g&&(y=1);j(T[y-1],y)})}function j(e,t){var n,r,i;t=t<10?"0"+t:t;n=Number(t)-1;r=Number(t)-1;$("#slide").html('<div id="progressing"></div>');$("#progressing").fadeIn();if(S){$("#vp").html("");$("#vp").hide();S=!1}if(E){k.setCurrentTime(0);k.pause();E=!1;if(L){$("#ap").hide();$("#note").height($("#note").height()+30)}else{$("#apm").hide();$("#currentStatus").css("width","76.85%")}}if(e.substring(0,e.indexOf(":")+1)==="image:"){i=new Image;C="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+N;A=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+A+'"href="'+C+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});R(!0)}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+C+"</p><p>Total number of slides: "+g+"</p><p>"+e+"</p>")}).attr({src:C,border:0})}else if(e.substring(0,e.indexOf(":")+1)==="youtube:"){R(!1);$("#slide").append('<iframe width="640" height="360" src="https://www.youtube.com/embed/'+e.substring(e.indexOf(":")+1)+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe>')}else if(e.substring(0,e.indexOf(":")+1)==="video:"){R(!1);var s=$.now();$("#vp").append('<video id="vpc'+s+'" class="video-js vjs-default-skin" controls autoplay preload="none" width="640" height="360" data-setup=\'{"controls":true}\'>'+(V(e.substring(e.indexOf(":")+1))?'<track kind="subtitles" src="assets/video/'+e.substring(e.indexOf(":")+1)+'.vtt" srclang="en" label="English" default>':"")+"</video>");if(!S){$("#vp").show();videojs("vpc"+s,{},function(){this.progressTips();this.src([{type:"video/mp4",src:"assets/video/"+e.substring(e.indexOf(":")+1)+".mp4"},{type:"video/webm",src:"assets/video/"+e.substring(e.indexOf(":")+1)+".webm"}])});videojs.options.flash.swf="sources/videoplayer/video-js.swf";S=!0}}else if(e.substring(0,e.indexOf(":")+1)==="swf:"){R(!1);$("#slide").append('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+e.substring(e.indexOf(":")+1)+'.swf"><param name="movie" value="assets/swf/'+e+'.swf" /><p>Your web browser does not support Adobe Flash.</p></object>')}else if(e.substring(0,e.indexOf(":")+1)==="image-audio:"){i=new Image;C="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+N;A=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+A+'"href="'+C+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});R(!0);if(!E){var t;if(L){$("#ap").show();if(m!==!0){k=new MediaElementPlayer("#apc",{audioWidth:640,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(n){t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];n.setSrc(t);n.load()}});m=!0}else{t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];k.setSrc(t)}$("#note").height($("#note").height()-30)}else{$("#apm").show();if(m!==!0){k=new MediaElementPlayer("#apcm",{audioWidth:300,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(n){t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];n.setSrc(t);n.load()}});m=!0}else{t=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}];k.setSrc(t)}$("#currentStatus").css("width","30%")}E=!0}}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+C+"</p><p>"+e+"</p>")}).attr({src:C,border:0})}else if(e==="quiz")try{U(n)}catch(o){console.append("<li>"+o+"</li>")}else $("#slide").html("<p>ERROR!</p>");F(r);q(t);$("#progressing").hide()}function F(e){var t=x.find("topic:eq("+e+")").find("note").text();$("#note").html(t);$("#note").find("a").length&&$("#note a").each(function(){$(this).attr("target","_blank")})}function I(){var e=new Image,t="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img src="'+t+'" alt="Instructor Photo" border="0" />')}).error(function(){$("#profile .photo").html('<img src="assets/img/profile.png" width="200" height="300" alt="No Profile Photo" border="0" />')}).attr({src:t,border:0})}function q(e){y=e;$("#selectable li").each(function(){$(this).removeClass("ui-selected")});$("#selectable li:nth-child("+Number(e)+")").addClass("ui-selected");$("#currentStatus").html("Slide "+e+" of "+(g<10?"0"+g:g))}function R(e){if(e){$("a#img, #magnifyIcon").on("mouseenter",function(){$("#magnifyIcon").show()});$("a#img, #magnifyIcon").on("mouseleave",function(){$("#magnifyIcon").hide()});$("#magnifyIcon").on("click",function(){$.fancybox.open({href:C,title:A,helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0})})}}function U(e){while(!_||D===M.length)M[D].id===e?_=!0:D++;$("#slide").append('<div id="quiz"><div class="header">Quiz '+(D+1)+" of "+M.length+"</div>");$("#quiz").hide();$("#quiz").fadeIn();if(!M[D].taken){$("#quiz").append('<div class="question">'+M[D].question+"</div>");if(M[D].type==="t/f")$("#quiz").append('<div class="answerArea"><label for="t"><input id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input type="radio" id="f" name="tf" value="false" /> False</label></div>');else if(M[D].type==="fib")$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>');else if(M[D].type==="mc"){$("#quiz").append('<div class="answerArea">');for(var t=0;t<M[D].choice.length;t++)$(".answerArea").append('<label for="'+t+'"><input id="'+t+'" type="radio" name="mc" value="'+M[D].choice[t]+'" /> '+M[D].choice[t]+"</label>");$("#quiz").append("</div>")}else M[D].type==="sa"?$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>'):$("#quiz").append('<div class="answerArea">ERROR!</div>');$("#quiz").append('<div class="submitArea"><button id="check" rel="'+D+'">SUBMIT</button></div>');$("#check").click(function(){var e=Number($(this).attr("rel")),t;if(M[e].type==="t/f"){t=$("input:radio[name=tf]:checked").val();t===undefined&&(t="")}else if(M[e].type==="fib")t=$.trim($("#saAns").val());else if(M[e].type==="mc"){t=$("input:radio[name=mc]:checked").val();M[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked"));t===undefined&&(t="")}else M[e].type==="sa"?t=$.trim($("#saAns").val()):$.trim(t);if(t!==""){for(var n=0;n<M[e].answer.length;n++)if(M[e].type==="fib"){var r=0;for(r;r<M[e].answer.length;r++)if(t.toLowerCase()===M[e].answer[r].toLowerCase()){M[e].correct=!0;break}}else M[e].type==="t/f"?t.toLowerCase()===M[e].answer[n].toLowerCase()?M[e].correct=!0:M[e].correct=!1:M[e].type==="mc"&&(t.toLowerCase()===M[e].answer[n].toLowerCase()?M[e].correct=!0:M[e].correct=!1);M[e].stuAnswer=t;M[e].taken=!0;z(e)}else alert("Please answer the question before submitting.")})}else z(D);$("#slide").append("</div>");D=0;_=!1}function z(e){var t="";$("#slide").html('<div id="quiz"><div class="header">Quiz '+(e+1)+" of "+M.length+" Feedback</div>");M[e].type!=="sa"&&(M[e].correct?$("#quiz").append('<p class="quizCorrect">Correct!</p>'):$("#quiz").append('<p class="quizIncorrect">Incorrect!</p>'));$("#quiz").append('<div class="question">'+M[e].question+"</div>");$("#quiz").append('<div class="feedback"><p><strong>Your anwser</strong>: '+M[e].stuAnswer+"</p>");for(var n=0;n<M[e].answer.length;n++)n===M[e].answer.length-1?t+=M[e].answer[n]:t+=M[e].answer[n]+", ";$(".feedback").append("<p><strong>Correct anwser</strong>: "+t+"</p></div>");if(M[e].type!=="sa")if(M[e].correct)$(".feedback").append("<p><strong>Feedback:</strong> "+M[e].correctFeedback+"</p>");else if(M[e].type==="mc"){var r=M[e].wrongFeedback[M[e].incorrectIndex];typeof r=="undefined"&&(r="");$(".feedback").append("<p><strong>Feedback:</strong> "+r+"</p>")}else $(".feedback").append("<p><strong>Feedback:</strong> "+M[e].wrongFeedback+"</p>")}function W(e,t){var n,r;e===0?n="<strong>Error 0</strong> - Not connect. Please verify network.":e===404?n="<strong>Error 404</strong> - Requested page not found.":e===406?n="<strong>Error 406</strong> - Not acceptable error.":e===500?n="<strong>Error 500</strong> - Internal Server Error.":n="Unknow error";t==="parsererror"?r="Requested XML parse failed.":t==="timeout"?r="Time out error.":t==="abort"?r="Ajax request aborted.":t==="error"?r="HTTP / URL Error (most likely a 404 or 406).":r="Uncaught Error.\n"+e.responseText;$("#player").hide();$("#errorMsg").html("<p>"+n+"<br />"+r+"</p>")}function X(e,t){var n;t==="pdf"?n="application/pdf":n="audio/mpeg";$.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:n,async:!1,beforeSend:function(e){e.overrideMimeType(n);e.setRequestHeader("Accept",n)},success:function(){var n=e,r=$("#download_bar ul"),i=window.location.protocol;if(i!=="http:"){var s=window.location.href;s=s.substr(0,s.lastIndexOf("/")+1).replace("https","http");n=s+e}t==="pdf"?r.append('<li><a href="'+n+"."+t+'" target="_blank">Transcript</a></li>'):t==="mp3"&&r.append('<li><a href="'+n+"."+t+'" target="_blank">Audio</a></li>')},error:function(){}})}function V(e){var t=!1;$.ajax({url:"assets/video/"+e+".vtt",type:"HEAD",dataType:"text",contentType:"text/vtt",async:!1,beforeSend:function(e){e.overrideMimeType("text/vtt");e.setRequestHeader("Accept","text/vtt")},success:function(){t=!0},error:function(){t=!1}});return t}var t=navigator.userAgent,n={iphone:t.match(/(iPhone|iPod|iPad)/),blackberry:t.match(/BlackBerry/),android:t.match(/Android/)},r=e("m")==="0"?!1:!0;if((n.iphone||n.ipod||n.ipad||n.blackberry||n.android)&&r){var i=window.location.href,s,o=i.indexOf(".");s=i.substr(o);i="http://webstreamer"+s+"?m=0";$("#player").hide();$("body").html('<div style="text-align:center; width:450px; height:315px;"><a href="'+i+'" target="_blank"><img src="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/img/view_on_full_site.png" width="450px" height="315px" alt="Launch Presentation in New Window" border="0" /></a></div>')}else{var u=14,a=18,f=22,l=26,c=20,h=24,p=18,d=22,v=!0,m=!1,g=0,y=1,b=0,w=0,E=!1,S=!1,x,T,N,C,k,L=!1,A,O,M,_=!1,D=0;$.ajaxSetup({url:"assets/topic.xml",type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1});$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8");e.setRequestHeader("Accept","text/xml")},success:function(e){P(e)},error:function(e,t){W(e.status,t)}})}});