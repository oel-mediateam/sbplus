/* global console *//* global videojs *//* global MediaElementPlayer *//* global alert */$(document).load(function(){$("noscript").hide()});$(document).ready(function(){function e(e){var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}function D(e){var t=$(e).find("setup"),n=$(e).find("topic"),r=$(e).find("profile").text(),i=t.find("lesson").text().length<=0?"Lesson name is not specified":t.find("lesson").text(),s=t.find("instructor").text().length<=0?"Instructor is not specified":'<a class="instructorP" href="#profile">'+t.find("instructor").text()+"</a>",o=t.find("length").text().length<=0?"":t.find("length").text();k=t.find("note").text().length<=0?!1:t.find("note").text();k==="yes"||k==="y"?k=!0:k=!1;if(!k){$("#note").hide();$("#fontMinusBtn").hide();$("#fontPlusBtn").hide();$("#fontSizeIndicator").hide();$("#toc").css("height","399px")}T=t.find("slideImgFormat").text().length<=0?"png":t.find("slideImgFormat").text();S=$(e);$("#lessonTitle").html(i);$("#instructorName").html(s);$("#profile .bio").html("<p>"+t.find("instructor").text()+"</p>"+r);x=[];O=[];n.each(function(){var e=$(this).attr("title");x[m]=$(this).attr("src");if(v===!0){$("#selectable").html('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(m+1<10?"0"+(m+1):m+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");v=!1}else $("#selectable").append('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(m+1<10?"0"+(m+1):m+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");if(x[m]==="quiz"){A={};A.id=m;A.type=S.find("topic:eq("+m+")").find("quiz").attr("type");A.question=S.find("topic:eq("+m+")").find("quiz").find("question").text();if(S.find("topic:eq("+m+")").find("quiz").find("choice").text()!==""){A.choice=P(S.find("topic:eq("+m+")").find("quiz").find("choice").text());A.wrongFeedback=P(S.find("topic:eq("+m+")").find("quiz").find("wrongFeedback").text())}else A.wrongFeedback=S.find("topic:eq("+m+")").find("quiz").find("wrongFeedback").text();A.answer=P(S.find("topic:eq("+m+")").find("quiz").find("answer").text());A.stuAnswer="";A.correct=!1;A.correctFeedback=S.find("topic:eq("+m+")").find("quiz").find("correctFeedback").text();A.taken=!1;O.push(A)}m++});$(document).attr("title",i);$("#splash_screen").append("<p>"+i+"</p><p>"+(t.find("instructor").text().length<=0?"Instructor is not specified":t.find("instructor").text())+"</p>"+(o!==0?"<p>"+o+"</p>":"")+'<p><a id="playBtn" href="#">&#9658</button></a>');$("#splash_screen").css("background-image","url(assets/splash.jpg)");k||$("#splash_screen").css({height:"230px","padding-top":"100px","padding-bottom":"100px","padding-right":"200px","padding-left":"200px"});$("#splash_screen, #playBtn").on("click",function(){H(i);$("#splash_screen").hide();return!1});i=i.toLowerCase().replace("-","_").replace(/\s+/g,"");W(i,"mp3");W(i,"pdf")}function P(e){var t=0,n=[],r=e,i,s;r+="|";s=r.indexOf("|");while(r.indexOf("|")!==-1){i=r.substring(0,s);r=r.substring(s+1);s=r.indexOf("|");n[t]=i;t++}return n}function H(){$("#player").show();B(x[0],g);$("#selectable li:first").addClass("ui-selected");$("#errorMsg").hide();$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){b=$("#selectable li").index(this)+1});if(b!==y){B(x[b-1],b);y=b}}});F();$("a#info, a.instructorP").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});if(k){$("#fontSizeIndicator").html(u);$("#fontMinusBtn").on("click",function(){u-=2;a-=2;f-=2;l-=2;c-=2;h-=2;p-=2;d-=2;if(u<=12){u=12;a=16}if(p<=16){p=16;d=20}if(c<=18){c=18;h=22}if(f<=20){f=20;l=24}$("#note, #note p").css({"font-size":u,"line-height":a+"px"});$("#note h1").css({"font-size":f,"line-height":h+"px"});$("#note h2").css({"font-size":c,"line-height":h+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":p,"line-height":d+"px"});$("#fontSizeIndicator").html(u)});$("#fontPlusBtn").on("click",function(){u+=2;a+=2;f+=2;l+=2;c+=2;h+=2;p+=2;d+=2;if(u>=28){u=28;a=32}if(p>=30){p=30;d=34}if(c>=32){c=32;h=36}if(f>=34){f=34;l=38}$("#note, #note p").css({"font-size":u,"line-height":a+"px"});$("#note h1").css({"font-size":f,"line-height":l+"px"});$("#note h2").css({"font-size":c,"line-height":h+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":p,"line-height":d+"px"});$("#fontSizeIndicator").html(u)})}$("#leftBtn").on("click",function(){g--;g<=0&&(g=m);B(x[g-1],g)});$("#rightBtn").on("click",function(){g++;g>m&&(g=1);B(x[g-1],g)})}function B(e,t){var n,r,i;t=t<10?"0"+t:t;n=Number(t)-1;r=Number(t)-1;$("#slide").html('<div id="progressing"></div>');$("#progressing").fadeIn();if(E){$("#vp").html("");$("#vp").hide();E=!1}if(w){C.setCurrentTime(0);C.pause();w=!1;if(k){$("#ap").hide();$("#note").height($("#note").height()+30)}else{$("#apm").hide();$("#currentStatus").css("width","76.85%")}}if(e.substring(0,e.indexOf(":")+1)==="image:"){i=new Image;N="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+T;L=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+L+'"href="'+N+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});q(!0)}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+N+"</p><p>Total number of slides: "+m+"</p><p>"+e+"</p>")}).attr({src:N,border:0})}else if(e.substring(0,e.indexOf(":")+1)==="youtube:"){q(!1);$("#slide").append('<iframe width="640" height="360" src="https://www.youtube.com/embed/'+e.substring(e.indexOf(":")+1)+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe>')}else if(e.substring(0,e.indexOf(":")+1)==="video:"){q(!1);var s=$.now();$("#vp").append('<video id="vpc'+s+'" class="video-js vjs-default-skin" controls autoplay preload="none" width="640" height="360" data-setup=\'{"controls":true}\'><source type="video/mp4" src="assets/video/'+e.substring(e.indexOf(":")+1)+'.mp4"'+' /><track kind="subtitles" src="assets/video/'+e.substring(e.indexOf(":")+1)+'.vtt" srclang="en" label="English" default></video>');if(!E){$("#vp").show();videojs("vpc"+s,{},function(){this.progressTips()});videojs.options.flash.swf="https://mediastreamer.doit.wisc.edu/uwli-ltc/sandbox/ethansandbox/StorybookPlus/version2/sources/videoplayer/video-js.swf";E=!0}}else if(e.substring(0,e.indexOf(":")+1)==="swf:"){q(!1);$("#slide").append('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+e.substring(e.indexOf(":")+1)+'.swf"><param name="movie" value="assets/swf/'+e+'.swf" /><p>Your web browser does not support Adobe Flash.</p></object>')}else if(e.substring(0,e.indexOf(":")+1)==="image-audio:"){i=new Image;N="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+T;L=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+L+'"href="'+N+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');k?$("#apc").html('<source type="audio/mpeg" src="assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /><object width="640" height="360" type="application/x-shockwave-flash" data="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus_v2/sources/audioplayer/flashmediaelement.swf"><param name="movie" value="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus_v2/sources/audioplayer/flashmediaelement.swf" /><param name="flashvars" value="controls=true&file=assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /></object>'):$("#apcm").html('<source type="audio/mpeg" src="assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /><object width="640" height="360" type="application/x-shockwave-flash" data="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus_v2/sources/audioplayer/flashmediaelement.swf"><param name="movie" value="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus_v2/sources/audioplayer/flashmediaelement.swf" /><param name="flashvars" value="controls=true&file=assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /></object>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});q(!0);if(!w){if(k){$("#ap").show();C=new MediaElementPlayer("#apc",{audioWidth:640,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0});$("#note").height($("#note").height()-30)}else{$("#apm").show();C=new MediaElementPlayer("#apcm",{audioWidth:300,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0});$("#currentStatus").css("width","30%")}C.play();w=!0}}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+N+"</p><p>"+e+"</p>")}).attr({src:N,border:0})}else if(e==="quiz")try{R(n)}catch(o){console.append("<li>"+o+"</li>")}else $("#slide").html("<p>ERROR!</p>");j(r);I(t);$("#progressing").hide()}function j(e){var t=S.find("topic:eq("+e+")").find("note").text();$("#note").html(t)}function F(){var e=new Image,t="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img src="'+t+'" alt="Instructor Photo" border="0" />')}).error(function(){$("#profile .photo").html('<img src="assets/img/profile.png" width="200" height="300" alt="No Profile Photo" border="0" />')}).attr({src:t,border:0})}function I(e){g=e;$("#selectable li").each(function(){$(this).removeClass("ui-selected")});$("#selectable li:nth-child("+Number(e)+")").addClass("ui-selected");$("#currentStatus").html("Slide "+e+" of "+(m<10?"0"+m:m))}function q(e){if(e){$("a#img, #magnifyIcon").on("mouseenter",function(){$("#magnifyIcon").show()});$("a#img, #magnifyIcon").on("mouseleave",function(){$("#magnifyIcon").hide()});$("#magnifyIcon").on("click",function(){$.fancybox.open({href:N,title:L,helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0})})}}function R(e){while(!M||_===O.length)O[_].id===e?M=!0:_++;$("#slide").append('<div id="quiz"><div class="header">Quiz '+(_+1)+" of "+O.length+"</div>");$("#quiz").hide();$("#quiz").fadeIn();if(!O[_].taken){$("#quiz").append('<div class="question">'+O[_].question+"</div>");if(O[_].type==="t/f")$("#quiz").append('<div class="answerArea"><label for="t"><input id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input type="radio" id="f" name="tf" value="false" /> False</label></div>');else if(O[_].type==="fib")$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>');else if(O[_].type==="mc"){$("#quiz").append('<div class="answerArea">');for(var t=0;t<O[_].choice.length;t++)$(".answerArea").append('<label for="'+t+'"><input id="'+t+'" type="radio" name="mc" value="'+O[_].choice[t]+'" /> '+O[_].choice[t]+"</label>");$("#quiz").append("</div>")}else O[_].type==="sa"?$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>'):$("#quiz").append('<div class="answerArea">ERROR!</div>');$("#quiz").append('<div class="submitArea"><button id="check" rel="'+_+'">SUBMIT</button></div>');$("#check").click(function(){var e=Number($(this).attr("rel")),t;if(O[e].type==="t/f"){t=$("input:radio[name=tf]:checked").val();t===undefined&&(t="")}else if(O[e].type==="fib")t=$.trim($("#saAns").val());else if(O[e].type==="mc"){t=$("input:radio[name=mc]:checked").val();O[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked"));t===undefined&&(t="")}else O[e].type==="sa"?t=$.trim($("#saAns").val()):$.trim(t);if(t!==""){for(var n=0;n<O[e].answer.length;n++)if(O[e].type==="fib"){var r=0;for(r;r<O[e].answer.length;r++)if(t.toLowerCase()===O[e].answer[r].toLowerCase()){O[e].correct=!0;break}}else O[e].type==="t/f"?t.toLowerCase()===O[e].answer[n].toLowerCase()?O[e].correct=!0:O[e].correct=!1:O[e].type==="mc"&&(t.toLowerCase()===O[e].answer[n].toLowerCase()?O[e].correct=!0:O[e].correct=!1);O[e].stuAnswer=t;O[e].taken=!0;U(e)}else alert("Please answer the question before submitting.")})}else U(_);$("#slide").append("</div>");_=0;M=!1}function U(e){var t="";$("#slide").html('<div id="quiz"><div class="header">Quiz '+(e+1)+" of "+O.length+" Feedback</div>");O[e].type!=="sa"&&(O[e].correct?$("#quiz").append('<p class="quizCorrect">Correct!</p>'):$("#quiz").append('<p class="quizIncorrect">Incorrect!</p>'));$("#quiz").append('<div class="question">'+O[e].question+"</div>");$("#quiz").append('<div class="feedback"><p><strong>Your anwser</strong>: '+O[e].stuAnswer+"</p>");for(var n=0;n<O[e].answer.length;n++)n===O[e].answer.length-1?t+=O[e].answer[n]:t+=O[e].answer[n]+", ";$(".feedback").append("<p><strong>Correct anwser</strong>: "+t+"</p></div>");if(O[e].type!=="sa")if(O[e].correct)$(".feedback").append("<p><strong>Feedback:</strong> "+O[e].correctFeedback+"</p>");else if(O[e].type==="mc"){var r=O[e].wrongFeedback[O[e].incorrectIndex];typeof r=="undefined"&&(r="");$(".feedback").append("<p><strong>Feedback:</strong> "+r+"</p>")}else $(".feedback").append("<p><strong>Feedback:</strong> "+O[e].wrongFeedback+"</p>")}function z(e,t){var n,r;e===0?n="<strong>Error 0</strong> - Not connect. Please verify network.":e===404?n="<strong>Error 404</strong> - Requested page not found.":e===406?n="<strong>Error 406</strong> - Not acceptable error.":e===500?n="<strong>Error 500</strong> - Internal Server Error.":n="Unknow error";t==="parsererror"?r="Requested XML parse failed.":t==="timeout"?r="Time out error.":t==="abort"?r="Ajax request aborted.":t==="error"?r="HTTP / URL Error (most likely a 404 or 406).":r="Uncaught Error.\n"+e.responseText;$("#player").hide();$("#errorMsg").html("<p>"+n+"<br />"+r+"</p>")}function W(e,t){var n;t==="pdf"?n="application/pdf":n="audio/mpeg";$.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:n,async:!1,beforeSend:function(e){e.overrideMimeType(n);e.setRequestHeader("Accept",n)},success:function(){var n=e,r=$("#download_bar ul"),i=window.location.protocol;if(i!=="http:"){var s=window.location.href;s=s.substr(0,s.lastIndexOf("/")+1).replace("https","http");n=s+e}t==="pdf"?r.append('<li><a href="'+n+"."+t+'" target="_blank">Transcript</a></li>'):t==="mp3"&&r.append('<li><a href="'+n+"."+t+'" target="_blank">MP3</a></li>')},error:function(){var e;t==="pdf"?e="Transcript":t==="mp3"&&(e="MP3");e+=" pending...";$("#download_bar ul").before("<p>"+e+"</p>")}})}var t=navigator.userAgent,n={iphone:t.match(/(iPhone|iPod|iPad)/),blackberry:t.match(/BlackBerry/),android:t.match(/Android/)},r=e("m")==="0"?!1:!0;if((n.iphone||n.ipod||n.ipad||n.blackberry||n.android)&&r){var i=window.location.href,s,o=i.indexOf(".");s=i.substr(o);i="http://webstreamer"+s+"?m=0";$("#player").hide();$("body").html('<div style="text-align:center; width:450px; height:315px;"><a href="'+i+'" target="_blank"><img src="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/img/view_on_full_site.png" width="450px" height="315px" alt="Launch Presentation in New Window" border="0" /></a></div>')}else{var u=14,a=18,f=22,l=26,c=20,h=24,p=18,d=22,v=!0,m=0,g=1,y=0,b=0,w=!1,E=!1,S,x,T,N,C,k=!1,L,A,O,M=!1,_=0;$.ajaxSetup({url:"assets/topic.xml",type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1});$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8");e.setRequestHeader("Accept","text/xml")},success:function(e){D(e)},error:function(e,t){z(e.status,t)}})}});