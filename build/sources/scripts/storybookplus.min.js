var pFontSize=14,pLineHeight=18,h1FontSize=22,h1LineHeight=26,h2FontSize=20,h2LineHeight=24,h3h4h5h6FontSize=18,h3h4h5h6LineHeight=22,topicCount=0,counter=1,previousIndex=0,tocIndex=0,XMLData,topicSrc,slideImgFormat="png",imgPath,media="Slide",enabledNote=!1,imgCaption,quiz,quizArray,found=!1,qNum=0,SETUP,TOPIC,LESSON,PROFILE,INSTRUCTOR,LENGTH,NOTE,SLIDEFORMAT,lessonTitle,instructor,duration,audioPlayer,firstAudioLoad=!1,audioPlaying=!1,videoPlaying=!1,sources;$(document).ready(function(){function e(e){for(;!found||qNum===quizArray.length;)quizArray[qNum].id===e?found=!0:qNum++;if($("#slide").append('<div id="quiz"><div class="header">Quiz '+(qNum+1)+" of "+quizArray.length+"</div>"),$("#quiz").hide(),$("#quiz").fadeIn(),quizArray[qNum].taken)i(qNum);else{if($("#quiz").append('<div class="question">'+quizArray[qNum].question+"</div>"),"t/f"===quizArray[qNum].type)$("#quiz").append('<div class="answerArea"><label for="t"><input id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input type="radio" id="f" name="tf" value="false" /> False</label></div>');else if("fib"===quizArray[qNum].type)$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>');else if("mc"===quizArray[qNum].type){$("#quiz").append('<div class="answerArea">');for(var t=0;t<quizArray[qNum].choice.length;t++)$(".answerArea").append('<label for="'+t+'"><input id="'+t+'" type="radio" name="mc" value="'+quizArray[qNum].choice[t]+'" /> '+quizArray[qNum].choice[t]+"</label>");$("#quiz").append("</div>")}else $("#quiz").append("sa"===quizArray[qNum].type?'<div class="answerArea"><textarea id="saAns"></textArea></div>':'<div class="answerArea">ERROR!</div>');$("#quiz").append('<div class="submitArea"><a id="check" rel="'+qNum+'" href="javascript:void(0)">SUBMIT</a></div>'),$("#check").click(function(){var e=Number($(this).attr("rel")),t;if("t/f"===quizArray[e].type?(t=$("input:radio[name=tf]:checked").val(),void 0===t&&(t="")):"fib"===quizArray[e].type?t=$.trim($("#saAns").val()):"mc"===quizArray[e].type?(t=$("input:radio[name=mc]:checked").val(),quizArray[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked")),void 0===t&&(t="")):"sa"===quizArray[e].type?t=$.trim($("#saAns").val()):$.trim(t),""!==t){for(var a=0;a<quizArray[e].answer.length;a++)if("fib"===quizArray[e].type){var r=0;for(r;r<quizArray[e].answer.length;r++)if(t.toLowerCase()===quizArray[e].answer[r].toLowerCase()){quizArray[e].correct=!0;break}}else"t/f"===quizArray[e].type?quizArray[e].correct=t.toLowerCase()===quizArray[e].answer[a].toLowerCase()?!0:!1:"mc"===quizArray[e].type&&(quizArray[e].correct=t.toLowerCase()===quizArray[e].answer[a].toLowerCase()?!0:!1);quizArray[e].stuAnswer=t,quizArray[e].taken=!0,i(e)}else alert("Please answer the question before submitting.")})}$("#slide").append("</div>"),qNum=0,found=!1}function i(e){var i="";$("#slide").html('<div id="quiz"><div class="header">Quiz '+(e+1)+" of "+quizArray.length+" Feedback</div>"),"sa"!==quizArray[e].type&&$("#quiz").append(quizArray[e].correct?'<p class="quizCorrect"><span class="icon-checkmark"></span> CORRECT</p>':'<p class="quizIncorrect"><span class="icon-notification"></span> INCORRECT</p>'),$("#quiz").append('<div class="question">'+quizArray[e].question+"</div>"),$("#quiz").append('<div class="feedback"><p><strong>Your answer</strong>: '+quizArray[e].stuAnswer+"</p>");for(var t=0;t<quizArray[e].answer.length;t++)i+=t===quizArray[e].answer.length-1?quizArray[e].answer[t]:quizArray[e].answer[t]+", ";if($(".feedback").append("<p><strong>Correct answer</strong>: "+i+"</p></div>"),"sa"!==quizArray[e].type)if(quizArray[e].correct)$(".feedback").append("<p><strong>Feedback:</strong> "+quizArray[e].correctFeedback+"</p>");else if("mc"===quizArray[e].type){var a=quizArray[e].wrongFeedback[quizArray[e].incorrectIndex];"undefined"==typeof a&&(a=""),$(".feedback").append("<p><strong>Feedback:</strong> "+a+"</p>")}else $(".feedback").append("<p><strong>Feedback:</strong> "+quizArray[e].wrongFeedback+"</p>")}function t(e){var i=!1;return $.ajax({url:"assets/video/"+e+".vtt",type:"HEAD",dataType:"text",contentType:"text/vtt",async:!1,beforeSend:function(e){e.overrideMimeType("text/vtt"),e.setRequestHeader("Accept","text/vtt")},success:function(){i=!0},error:function(){i=!1}}),i}var a=navigator.userAgent,r={iphone:a.match(/(iPhone|iPod|iPad)/),blackberry:a.match(/BlackBerry/),android:a.match(/Android/)},n="0"===$(this).getParameterByName("m")?!1:!0;if((r.iphone||r.ipod||r.ipad||r.blackberry||r.android)&&n){var o=window.location.href,s=o.indexOf("."),d;return d=o.substr(s),o="http://mediastreamer"+d+"?m=0",$("body").html('<div style="text-align:center; width:450px; height:315px;"><a href="'+o+'" target="_blank"><img src="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/img/view_on_full_site.png" width="450px" height="315px" alt="Launch Presentation in New Window" border="0" /></a></div>'),!1}$(this).ajaxCall("assets/topic.xml")}),$.fn.ajaxCall=function(e){$.ajaxSetup({url:e,type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1}),$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(e){$(this).parseXML(e)},error:function(e,i){$(this).displayError(e.status,i)}})},$.fn.parseXML=function(e){SETUP=$(e).find("setup"),TOPIC=$(e).find("topic"),LESSON=$.trim(SETUP.find("lesson").text()),PROFILE=$.trim($(e).find("profile").text()),INSTRUCTOR=$.trim(SETUP.find("instructor").text()),LENGTH=$.trim(SETUP.find("length").text()),NOTE=$.trim(SETUP.find("note").text()),SLIDEFORMAT=$.trim(SETUP.find("slideImgFormat").text()),lessonTitle="Lesson name is not specified.",instructor="Instructor name is not specified.",duration="",LESSON.length&&(lessonTitle=LESSON),INSTRUCTOR.length&&(instructor=INSTRUCTOR),LENGTH.length&&(duration=LENGTH),NOTE.length&&("yes"===NOTE||"y"===NOTE)&&(enabledNote=!0),SLIDEFORMAT.length&&(slideImgFormat=SLIDEFORMAT),XMLData=$(e),topicSrc=[],quizArray=[],TOPIC.each(function(){var e=$(this).attr("title");if(topicSrc[topicCount]=$(this).attr("src"),"quiz"===topicSrc[topicCount]){var i=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("question").text()),t=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("choice").text()),a=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("wrongFeedback").text()),r=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("correctFeedback").text()),n=XMLData.find("topic:eq("+topicCount+")").find("quiz").attr("type"),o=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("answer").text());quiz={},quiz.id=topicCount,quiz.type=n,quiz.question=i,t?(quiz.choice=$(this).splitSelections(t),quiz.wrongFeedback=$(this).splitSelections(a)):quiz.wrongFeedback=a,quiz.answer=$(this).splitSelections(o),quiz.stuAnswer="",quiz.correct=!1,quiz.correctFeedback=r,quiz.taken=!1,quizArray.push(quiz)}$("#selectable").append('<li class="ui-widget-content" title="'+e+'"><div class="slideNum">'+(10>topicCount+1?"0"+(topicCount+1):topicCount+1)+'.</div><div class="title">'+e+"</div></li>"),topicCount++}),$(this).setupPlayer()},$.fn.setupPlayer=function(){var e=$(this).getDirectory();$(document).attr("title",lessonTitle),enabledNote||$("#storybook_plus_wrapper").addClass("noteDisabled"),$("#errorMsg").hide(),$("#splash_screen").css("background-image","url(assets/splash.jpg)"),$("#splash_screen").append("<p>"+lessonTitle+"</p><p>"+instructor+"</p>"+(0!==duration?"<p><small>"+duration+"</small></p>":"")+'<a class="playBtn" href="#"></a>'),$("#splash_screen, #playBtn").on("click",function(){return $.fn.initializePlayer(),!1}),$(this).getDownloadableFile(e,"mp3"),$(this).getDownloadableFile(e,"pdf")},$.fn.initializePlayer=function(){$.each(topicSrc,function(e){var i=topicSrc[e].substring(0,topicSrc[e].indexOf(":")+1);return"video:"!==i&&"youtube:"!==i?(media="Slide",!1):void(media="Video")}),$("#splash_screen").hide(),$("#lessonTitle").html(lessonTitle),$("#instructorName").html('<a class="instructorName" href="#profile">'+instructor+"</a>"),$("#profile .bio").html("<p>"+instructor+"</p>"+PROFILE),$("#info, a.instructorName").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0}),$("#selectable li:first").addClass("ui-selected"),$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){tocIndex=$("#selectable li").index(this)+1}),tocIndex!==previousIndex&&($(this).loadSlide(topicSrc[tocIndex-1],tocIndex),previousIndex=tocIndex)}}),$("#leftBtn").on("click",function(){counter--,0>=counter&&(counter=topicCount),$(this).loadSlide(topicSrc[counter-1],counter)}),$("#rightBtn").on("click",function(){counter++,counter>topicCount&&(counter=1),$(this).loadSlide(topicSrc[counter-1],counter)}),enabledNote&&($("#fontSizeIndicator").html(pFontSize),$("#fontMinusBtn").on("click",function(){$.fn.adjustFontSize("minus")}),$("#fontPlusBtn").on("click",function(){$.fn.adjustFontSize("plus")})),$(this).loadSlide(topicSrc[0],counter),$(this).loadProfilePhoto(),$("#player").show()},$.fn.loadSlide=function(e,i){var t,a,r,n=e,o=e.substring(e.indexOf(":")+1);if("quiz"!==n&&(n=e.substring(0,e.indexOf(":")+1)),i=10>i?"0"+i:i,t=Number(i)-1,a=Number(i)-1,$("#slide").html('<div id="progressing"></div>'),videoPlaying&&($("#vp").html(""),$("#vp").hide(),videoPlaying=!1),audioPlaying){try{audioPlayer.pause()}catch(s){}enabledNote?($("#ap").hide(),$("#note").height($("#note").height()+30)):$("#apm").hide(),audioPlaying=!1}switch(n){case"image:":r=new Image,imgPath="assets/slides/"+o+"."+slideImgFormat,imgCaption=$("#selectable li .title").get(t).innerHTML,$(r).load(function(){$(this).hide(),$("#slide").append('<a id="img" title="'+imgCaption+'" href="'+imgPath+'">'),$("#slide #img").html(r),$("#slide").append('</a><div class="magnifyIcon"></div>'),$(this).fadeIn(),$(this).bindImgMagnify()}).error(function(){$("#slide").html('<div id="errorMsg"><p><strong>Error</strong>: image not found!</p><p>Expected image: '+imgPath+"</p></div>")}).attr({src:imgPath,border:0});break;case"image-audio:":r=new Image,imgPath="assets/slides/"+o+"."+slideImgFormat,imgCaption=$("#selectable li .title").get(t).innerHTML,$(r).load(function(){$(this).hide(),$("#slide").append('<a id="img" title="'+imgCaption+'"href="'+imgPath+'">'),$("#slide #img").html(r),$("#slide").append('</a><div class="magnifyIcon"></div>'),$(this).fadeIn(),$(this).bindImgMagnify(),audioPlaying||(enabledNote?($.fn.fileExists(o+".mp3","audio/mpeg")?($("#ap").show(),firstAudioLoad!==!0?($(this).loadAudioPlayer("#apc",o),firstAudioLoad=!0):(sources=[{src:"assets/audio/"+o+".mp3",type:"audio/mpeg"}],audioPlayer.setSrc(sources))):($("#ap").hide(),$("#slide").html('<div id="errorMsg"><p>Error: Audio file not found!</p><p>Expected file: assets/audio/'+o+".mp3</div>")),$("#note").height($("#note").height()-30)):$.fn.fileExists(o+".mp3","audio/mpeg")?($("#apm").show(),firstAudioLoad!==!0?($(this).loadAudioPlayer("#apcm",o),firstAudioLoad=!0):(sources=[{src:"assets/audio/"+o+".mp3",type:"audio/mpeg"}],audioPlayer.setSrc(sources))):($("#apm").hide(),$("#slide").html('<div id="errorMsg"><p>Error: Audio file not found!</p><p>Expected file: assets/audio/'+o+".mp3</div>")),audioPlaying=!0)}).error(function(){$("#slide").html('<div id="errorMsg"><p><strong>Error</strong>: image not found!</p><p>Expected image: '+imgPath+"</p></div>")}).attr({src:imgPath,border:0});break;case"video:":var d=$.now(),c="vpc"+d;$("#vp").append('<video id="'+c+'" class="video-js vjs-default-skin" controls autoplay width="640" height="360">'+(sbttlExist(o)?'<track kind="subtitles" src="assets/video/'+o+'.vtt" srclang="en" label="English" default>':"")+"</video>"),videoPlaying||($("#vp").show(),videojs(c,{},function(){this.progressTips(),this.src([{type:"video/mp4",src:"assets/video/"+o+".mp4"},{type:"video/webm",src:"assets/video/"+o+".webm"}])}),videojs.options.flash.swf="sources/videoplayer/video-js.swf",videoPlaying=!0);break;case"youtube:":$("#slide").append('<iframe width="640" height="360" src="http://www.youtube.com/embed/'+o+'?modestbranding=1&theme=light&color=white&showinfo=0&autoplay=1&controls=2&html5=1&autohide=1&rel=0" frameborder="0" allowfullscreen></iframe>');break;case"swf:":$("#slide").append('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+o+'.swf"><param name="movie" value="assets/swf/'+e+'.swf" /><div id="errorMsg"><p>Error: Adobe Flash Player is not enabled or installed!</p><p>Adobe Flash Player is required to view this slide. Please enable or <a href="http://get.adobe.com/flashplayer/" target="_blank">install Adobe Flash Player</a>.</p></div></object>');break;case"quiz":setupQuiz(t);break;default:$("#slide").html('<div id="errorMsg"><p><strong>Error:</strong>Error: Unknow slide type!</p><p>Please double check the XML file.</p></div>')}$("#progressing").hide(),$(this).loadNote(a),$(this).updateSlideNum(i)},$.fn.loadAudioPlayer=function(e,i){var t=640,a=30;"#apcm"===e&&(t=300,a=0),audioPlayer=new MediaElementPlayer(e,{audioWidth:t,audioHeight:a,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(e){sources=[{src:"assets/audio/"+i+".mp3",type:"audio/mpeg"}],e.setSrc(sources),e.load()}})},$.fn.loadNote=function(e){var i=XMLData.find("topic:eq("+e+")").find("note").text();$("#note").html(i),$("#note").find("a").length&&$("#note a").each(function(){$(this).attr("target","_blank")})},$.fn.updateSlideNum=function(e){counter=e,$("#selectable li").each(function(){$(this).removeClass("ui-selected")}),$("#selectable li:nth-child("+Number(e)+")").addClass("ui-selected"),$("#currentStatus").html(media+" "+e+" of "+(10>topicCount?"0"+topicCount:topicCount))},$.fn.bindImgMagnify=function(){$(".magnifyIcon").on("click",function(){$.fancybox.open({href:imgPath,title:imgCaption,helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0})}),$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0})},$.fn.loadProfilePhoto=function(){var e=new Image,i="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img src="'+i+'" alt="Instructor Photo" border="0" />')}).error(function(){$("#profile .photo").html('<img src="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/img/profile.png" width="200" height="300" alt="No Profile Photo" border="0" />')}).attr({src:i,border:0})},$.fn.adjustFontSize=function(e){var i=2;"minus"===e?(pFontSize-=i,pLineHeight-=i,h1FontSize-=i,h1LineHeight-=i,h2FontSize-=i,h2LineHeight-=i,h3h4h5h6FontSize-=i,h3h4h5h6LineHeight-=i):"plus"===e&&(pFontSize+=i,pLineHeight+=i,h1FontSize+=i,h1LineHeight+=i,h2FontSize+=i,h2LineHeight+=i,h3h4h5h6FontSize+=i,h3h4h5h6LineHeight+=i),12>=pFontSize?(pFontSize=12,pLineHeight=16):pFontSize>=28&&(pFontSize=28,pLineHeight=32),16>=h3h4h5h6FontSize?(h3h4h5h6FontSize=16,h3h4h5h6LineHeight=20):h3h4h5h6FontSize>=30&&(h3h4h5h6FontSize=30,h3h4h5h6LineHeight=34),18>=h2FontSize?(h2FontSize=18,h2LineHeight=22):h2FontSize>=32&&(h2FontSize=32,h2LineHeight=36),20>=h1FontSize?(h1FontSize=20,h1LineHeight=24):h1FontSize>=34&&(h1FontSize=34,h1LineHeight=38),$("#note, #note p").css({"font-size":pFontSize,"line-height":pLineHeight+"px"}),$("#note h1").css({"font-size":h1FontSize,"line-height":h2LineHeight+"px"}),$("#note h2").css({"font-size":h2FontSize,"line-height":h2LineHeight+"px"}),$("#note h3, #note h4, #note h5, #note h6").css({"font-size":h3h4h5h6FontSize,"line-height":h3h4h5h6LineHeight+"px"}),$("#fontSizeIndicator").html(pFontSize)},$.fn.getDownloadableFile=function(e,i){var t="audio/mpeg";"pdf"===i&&(t="application/pdf"),$.ajax({url:e+"."+i,type:"HEAD",dataType:"text",contentType:t,async:!1,beforeSend:function(e){e.overrideMimeType(t),e.setRequestHeader("Accept",t)},success:function(){var t=e,a="Audio",r=$("#download_bar ul"),n=window.location.protocol;if("http:"!==n){var o=window.location.href;o=o.substr(0,o.lastIndexOf("/")+1).replace("https","http"),t=o+e}"pdf"===i&&(a="Transcript"),r.append('<li><a href="'+t+"."+i+'" target="_blank"><span class="icon-arrow-down"><span> '+a+"</a></li>")}})},$.fn.displayError=function(e,i){var t,a;switch(e){case 0:t="<strong>Error 0</strong> - Not connect. Please verify network.";break;case 404:t="<strong>Error 404</strong> - Requested page not found.";break;case 406:t="<strong>Error 406</strong> - Not acceptable error.";break;case 500:t="<strong>Error 500</strong> - Internal Server Error.";break;default:t="Unknow error ... "+e}switch(i){case"parsererror":a="Invalid XML. XML parse failed.";break;case"timeout":a="XML parsing timed out.";break;case"abort":a="Ajax request aborted.";break;case"error":a="Failed to get requested source. Most likely a 404 or 406.";break;default:a="Uncaught Error ... "+e.responseText}$("#splash_screen, #player").hide(),$("#errorMsg").html("<p>"+t+"<br />"+a+"</p>")},$.fn.splitSelections=function(e){var i=e.split("|");return i},$.fn.getDirectory=function(){var e=window.location.href,i;return i=e.split("?"),i=i[0].split("/"),i=i[i.length-2]},$.fn.fileExists=function(e,i){var t;return $.ajax({url:"assets/audio/"+e,type:"HEAD",dataType:"text",contentType:i,async:!1,beforeSend:function(e){e.overrideMimeType(i),e.setRequestHeader("Accept",i)},success:function(){t=!0},error:function(){t=!1}}),t},$.fn.getParameterByName=function(e){var i="[\\?&]"+e+"=([^&#]*)",t=new RegExp(i),a=t.exec(window.location.href);return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))};