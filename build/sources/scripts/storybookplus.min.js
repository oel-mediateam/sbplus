var media="Slide",pFontSize=14,pLineHeight=18,h1FontSize=22,h1LineHeight=26,h2FontSize=20,h2LineHeight=24,h3h4h5h6FontSize=18,h3h4h5h6LineHeight=22,firstAudioLoad=!1,topicCount=0,counter=1,previousIndex=0,tocIndex=0,audioPlaying=!1,videoPlaying=!1,XMLData,topicSrc,slideImgFormat="png",imgPath,audioPlayer,enabledNote=!1,imgCaption,quiz,quizArray,found=!1,qNum=0;$(document).ready(function(){function e(){$("#player").show(),jQuery.each(topicSrc,function(e){var i=topicSrc[e].substring(0,topicSrc[e].indexOf(":")+1);return"video:"!==i&&"youtube:"!==i?(media="Slide",!1):void(media="Video")}),i(topicSrc[0],counter),$("#selectable li:first").addClass("ui-selected"),$("#errorMsg").hide(),$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){tocIndex=$("#selectable li").index(this)+1}),tocIndex!==previousIndex&&(i(topicSrc[tocIndex-1],tocIndex),previousIndex=tocIndex)}}),n(),$("a#info, a.instructorName").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0}),enabledNote&&($("#fontSizeIndicator").html(pFontSize),$("#fontMinusBtn").on("click",function(){pFontSize-=2,pLineHeight-=2,h1FontSize-=2,h1LineHeight-=2,h2FontSize-=2,h2LineHeight-=2,h3h4h5h6FontSize-=2,h3h4h5h6LineHeight-=2,12>=pFontSize&&(pFontSize=12,pLineHeight=16),16>=h3h4h5h6FontSize&&(h3h4h5h6FontSize=16,h3h4h5h6LineHeight=20),18>=h2FontSize&&(h2FontSize=18,h2LineHeight=22),20>=h1FontSize&&(h1FontSize=20,h1LineHeight=24),$("#note, #note p").css({"font-size":pFontSize,"line-height":pLineHeight+"px"}),$("#note h1").css({"font-size":h1FontSize,"line-height":h2LineHeight+"px"}),$("#note h2").css({"font-size":h2FontSize,"line-height":h2LineHeight+"px"}),$("#note h3, #note h4, #note h5, #note h6").css({"font-size":h3h4h5h6FontSize,"line-height":h3h4h5h6LineHeight+"px"}),$("#fontSizeIndicator").html(pFontSize)}),$("#fontPlusBtn").on("click",function(){pFontSize+=2,pLineHeight+=2,h1FontSize+=2,h1LineHeight+=2,h2FontSize+=2,h2LineHeight+=2,h3h4h5h6FontSize+=2,h3h4h5h6LineHeight+=2,pFontSize>=28&&(pFontSize=28,pLineHeight=32),h3h4h5h6FontSize>=30&&(h3h4h5h6FontSize=30,h3h4h5h6LineHeight=34),h2FontSize>=32&&(h2FontSize=32,h2LineHeight=36),h1FontSize>=34&&(h1FontSize=34,h1LineHeight=38),$("#note, #note p").css({"font-size":pFontSize,"line-height":pLineHeight+"px"}),$("#note h1").css({"font-size":h1FontSize,"line-height":h1LineHeight+"px"}),$("#note h2").css({"font-size":h2FontSize,"line-height":h2LineHeight+"px"}),$("#note h3, #note h4, #note h5, #note h6").css({"font-size":h3h4h5h6FontSize,"line-height":h3h4h5h6LineHeight+"px"}),$("#fontSizeIndicator").html(pFontSize)})),$("#leftBtn").on("click",function(){counter--,0>=counter&&(counter=topicCount),i(topicSrc[counter-1],counter)}),$("#rightBtn").on("click",function(){counter++,counter>topicCount&&(counter=1),i(topicSrc[counter-1],counter)})}function i(e,i){var n,s,d;if(i=10>i?"0"+i:i,n=Number(i)-1,s=Number(i)-1,$("#slide").html('<div id="progressing"></div>'),$("#progressing").show(),videoPlaying&&($("#vp").html(""),$("#vp").hide(),videoPlaying=!1),audioPlaying&&(audioPlayer.setCurrentTime(0),audioPlayer.pause(),audioPlaying=!1,enabledNote?($("#ap").hide(),$("#note").height($("#note").height()+30)):$("#apm").hide()),"image:"===e.substring(0,e.indexOf(":")+1))d=new Image,imgPath="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+slideImgFormat,imgCaption=$("#selectable li .title").get(n).innerHTML,$(d).load(function(){$(this).hide(),$("#slide").append('<a id="img" title="'+imgCaption+'"href="'+imgPath+'">'),$("#slide #img").html(d),$("#slide").append('</a><div class="magnifyIcon"></div>'),$(this).fadeIn(),$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0}),a(!0)}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+imgPath+"</p><p>Total number of slides: "+topicCount+"</p><p>"+e+"</p>")}).attr({src:imgPath,border:0});else if("youtube:"===e.substring(0,e.indexOf(":")+1))a(!1),$("#slide").append('<iframe width="640" height="360" src="https://www.youtube.com/embed/'+e.substring(e.indexOf(":")+1)+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe>');else if("video:"===e.substring(0,e.indexOf(":")+1)){a(!1);var l=$.now(),u="vpc"+l;$("#vp").append('<video id="'+u+'" class="video-js vjs-default-skin" controls autoplay width="640" height="360">'+(c(e.substring(e.indexOf(":")+1))?'<track kind="subtitles" src="assets/video/'+e.substring(e.indexOf(":")+1)+'.vtt" srclang="en" label="English" default>':"")+"</video>"),videoPlaying||($("#vp").show(),videojs(u,{},function(){this.progressTips(),this.src([{type:"video/mp4",src:"assets/video/"+e.substring(e.indexOf(":")+1)+".mp4"},{type:"video/webm",src:"assets/video/"+e.substring(e.indexOf(":")+1)+".webm"}])}),videojs.options.flash.swf="sources/videoplayer/video-js.swf",videoPlaying=!0)}else if("swf:"===e.substring(0,e.indexOf(":")+1))a(!1),$("#slide").append('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+e.substring(e.indexOf(":")+1)+'.swf"><param name="movie" value="assets/swf/'+e+'.swf" /><p>Your web browser does not support Adobe Flash.</p></object>');else if("image-audio:"===e.substring(0,e.indexOf(":")+1))d=new Image,imgPath="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+slideImgFormat,imgCaption=$("#selectable li .title").get(n).innerHTML,$(d).load(function(){if($(this).hide(),$("#slide").append('<a id="img" title="'+imgCaption+'"href="'+imgPath+'">'),$("#slide #img").html(d),$("#slide").append('</a><div class="magnifyIcon"></div>'),$(this).fadeIn(),$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0}),a(!0),!audioPlaying){var i;enabledNote?($("#ap").show(),firstAudioLoad!==!0?(audioPlayer=new MediaElementPlayer("#apc",{audioWidth:640,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(t){i=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}],t.setSrc(i),t.load()}}),firstAudioLoad=!0):(i=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}],audioPlayer.setSrc(i)),$("#note").height($("#note").height()-30)):($("#apm").show(),firstAudioLoad!==!0?(audioPlayer=new MediaElementPlayer("#apcm",{audioWidth:300,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0,type:"audio/mpeg",success:function(t){i=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}],t.setSrc(i),t.load()}}),firstAudioLoad=!0):(i=[{src:"assets/audio/"+e.substring(e.indexOf(":")+1)+".mp3",type:"audio/mpeg"}],audioPlayer.setSrc(i))),audioPlaying=!0}}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+imgPath+"</p><p>"+e+"</p>")}).attr({src:imgPath,border:0});else if("quiz"===e)try{o(n)}catch(p){console.append("<li>"+p+"</li>")}else $("#slide").html("<p>ERROR!</p>");t(s),r(i),$("#progressing").hide()}function t(e){var i=XMLData.find("topic:eq("+e+")").find("note").text();$("#note").html(i),$("#note").find("a").length&&$("#note a").each(function(){$(this).attr("target","_blank")})}function n(){var e=new Image,i="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img src="'+i+'" alt="Instructor Photo" border="0" />')}).error(function(){$("#profile .photo").html('<img src="assets/img/profile.png" width="200" height="300" alt="No Profile Photo" border="0" />')}).attr({src:i,border:0})}function r(e){counter=e,$("#selectable li").each(function(){$(this).removeClass("ui-selected")}),$("#selectable li:nth-child("+Number(e)+")").addClass("ui-selected"),$("#currentStatus").html(media+" "+e+" of "+(10>topicCount?"0"+topicCount:topicCount))}function a(e){e&&$(".magnifyIcon").on("click",function(){$.fancybox.open({href:imgPath,title:imgCaption,helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0})})}function o(e){for(;!found||qNum===quizArray.length;)quizArray[qNum].id===e?found=!0:qNum++;if($("#slide").append('<div id="quiz"><div class="header">Quiz '+(qNum+1)+" of "+quizArray.length+"</div>"),$("#quiz").hide(),$("#quiz").fadeIn(),quizArray[qNum].taken)s(qNum);else{if($("#quiz").append('<div class="question">'+quizArray[qNum].question+"</div>"),"t/f"===quizArray[qNum].type)$("#quiz").append('<div class="answerArea"><label for="t"><input id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input type="radio" id="f" name="tf" value="false" /> False</label></div>');else if("fib"===quizArray[qNum].type)$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>');else if("mc"===quizArray[qNum].type){$("#quiz").append('<div class="answerArea">');for(var i=0;i<quizArray[qNum].choice.length;i++)$(".answerArea").append('<label for="'+i+'"><input id="'+i+'" type="radio" name="mc" value="'+quizArray[qNum].choice[i]+'" /> '+quizArray[qNum].choice[i]+"</label>");$("#quiz").append("</div>")}else $("#quiz").append("sa"===quizArray[qNum].type?'<div class="answerArea"><textarea id="saAns"></textArea></div>':'<div class="answerArea">ERROR!</div>');$("#quiz").append('<div class="submitArea"><a id="check" rel="'+qNum+'" href="javascript:void(0)">SUBMIT</a></div>'),$("#check").click(function(){var e=Number($(this).attr("rel")),i;if("t/f"===quizArray[e].type?(i=$("input:radio[name=tf]:checked").val(),void 0===i&&(i="")):"fib"===quizArray[e].type?i=$.trim($("#saAns").val()):"mc"===quizArray[e].type?(i=$("input:radio[name=mc]:checked").val(),quizArray[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked")),void 0===i&&(i="")):"sa"===quizArray[e].type?i=$.trim($("#saAns").val()):$.trim(i),""!==i){for(var t=0;t<quizArray[e].answer.length;t++)if("fib"===quizArray[e].type){var n=0;for(n;n<quizArray[e].answer.length;n++)if(i.toLowerCase()===quizArray[e].answer[n].toLowerCase()){quizArray[e].correct=!0;break}}else"t/f"===quizArray[e].type?quizArray[e].correct=i.toLowerCase()===quizArray[e].answer[t].toLowerCase()?!0:!1:"mc"===quizArray[e].type&&(quizArray[e].correct=i.toLowerCase()===quizArray[e].answer[t].toLowerCase()?!0:!1);quizArray[e].stuAnswer=i,quizArray[e].taken=!0,s(e)}else alert("Please answer the question before submitting.")})}$("#slide").append("</div>"),qNum=0,found=!1}function s(e){var i="";$("#slide").html('<div id="quiz"><div class="header">Quiz '+(e+1)+" of "+quizArray.length+" Feedback</div>"),"sa"!==quizArray[e].type&&$("#quiz").append(quizArray[e].correct?'<p class="quizCorrect"><span class="icon-checkmark"></span> CORRECT</p>':'<p class="quizIncorrect"><span class="icon-notification"></span> INCORRECT</p>'),$("#quiz").append('<div class="question">'+quizArray[e].question+"</div>"),$("#quiz").append('<div class="feedback"><p><strong>Your answer</strong>: '+quizArray[e].stuAnswer+"</p>");for(var t=0;t<quizArray[e].answer.length;t++)i+=t===quizArray[e].answer.length-1?quizArray[e].answer[t]:quizArray[e].answer[t]+", ";if($(".feedback").append("<p><strong>Correct answer</strong>: "+i+"</p></div>"),"sa"!==quizArray[e].type)if(quizArray[e].correct)$(".feedback").append("<p><strong>Feedback:</strong> "+quizArray[e].correctFeedback+"</p>");else if("mc"===quizArray[e].type){var n=quizArray[e].wrongFeedback[quizArray[e].incorrectIndex];"undefined"==typeof n&&(n=""),$(".feedback").append("<p><strong>Feedback:</strong> "+n+"</p>")}else $(".feedback").append("<p><strong>Feedback:</strong> "+quizArray[e].wrongFeedback+"</p>")}function c(e){var i=!1;return $.ajax({url:"assets/video/"+e+".vtt",type:"HEAD",dataType:"text",contentType:"text/vtt",async:!1,beforeSend:function(e){e.overrideMimeType("text/vtt"),e.setRequestHeader("Accept","text/vtt")},success:function(){i=!0},error:function(){i=!1}}),i}var d=navigator.userAgent,l={iphone:d.match(/(iPhone|iPod|iPad)/),blackberry:d.match(/BlackBerry/),android:d.match(/Android/)},u="0"===$(this).getParameterByName("m")?!1:!0;if((l.iphone||l.ipod||l.ipad||l.blackberry||l.android)&&u){var p=window.location.href,h=p.indexOf("."),f;return f=p.substr(h),p="http://mediastreamer"+f+"?m=0",$("body").html('<div style="text-align:center; width:450px; height:315px;"><a href="'+p+'" target="_blank"><img src="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/img/view_on_full_site.png" width="450px" height="315px" alt="Launch Presentation in New Window" border="0" /></a></div>'),!1}$(this).ajaxCall("assets/topic.xml")}),$.fn.getParameterByName=function(e){var i="[\\?&]"+e+"=([^&#]*)",t=new RegExp(i),n=t.exec(window.location.href);return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},$.fn.ajaxCall=function(e){$.ajaxSetup({url:e,type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1}),$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(e){$(this).parseXML(e)},error:function(e,i){$(this).displayError(e.status,i)}})},$.fn.parseXML=function(e){var i=$(e).find("setup"),t=$(e).find("topic"),n=$.trim(i.find("lesson").text()),r=$.trim($(e).find("profile").text()),a=$.trim(i.find("instructor").text()),o=$.trim(i.find("length").text()),s=$.trim(i.find("note").text()),c=$.trim(i.find("slideImgFormat").text()),d="Lesson name is not specified.",l="Instructor name is not specified.",u="",p=!0;n.length&&(d=n),a.length&&(l='<a class="instructorName" href="#profile">'+a+"</a>"),o.length&&(u=o),s.length&&("yes"===s||"y"===s)&&(enabledNote=!0),c.length&&(slideImgFormat=c),XMLData=$(e),topicSrc=[],quizArray=[],t.each(function(){var e=$(this).attr("title");if(topicSrc[topicCount]=$(this).attr("src"),p===!0?($("#selectable").html('<li class="ui-widget-content" title="'+e+'"><div class="slideNum">'+(10>topicCount+1?"0"+(topicCount+1):topicCount+1)+'.</div><div class="title">'+e+"</div></li>"),p=!1):$("#selectable").append('<li class="ui-widget-content" title="'+e+'"><div class="slideNum">'+(10>topicCount+1?"0"+(topicCount+1):topicCount+1)+'.</div><div class="title">'+e+"</div></li>"),"quiz"===topicSrc[topicCount]){var i=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("question").text()),t=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("choice").text()),n=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("wrongFeedback").text()),r=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("correctFeedback").text()),a=XMLData.find("topic:eq("+topicCount+")").find("quiz").attr("type"),o=$.trim(XMLData.find("topic:eq("+topicCount+")").find("quiz").find("answer").text());quiz={},quiz.id=topicCount,quiz.type=a,quiz.question=i,t?(quiz.choice=$(this).splitSelections(t),quiz.wrongFeedback=$(this).splitSelections(n)):quiz.wrongFeedback=n,quiz.answer=$(this).splitSelections(o),quiz.stuAnswer="",quiz.correct=!1,quiz.correctFeedback=r,quiz.taken=!1,quizArray.push(quiz)}topicCount++});var h=$(this).getDirectory();enabledNote||$("#storybook_plus_wrapper").addClass("noteDisabled"),$("#lessonTitle").html(d),$("#instructorName").html(l),$("#profile .bio").html("<p>"+l+"</p>"+r),$(document).attr("title",d),$("#splash_screen").append("<p>"+d+"</p><p>"+(i.find("instructor").text().length<=0?"Instructor is not specified":i.find("instructor").text())+"</p>"+(0!==u?"<p><small>"+u+"</small></p>":"")+'<a class="playBtn" href="#"></a>'),$("#splash_screen").css("background-image","url(assets/splash.jpg)"),$("#splash_screen, #playBtn").on("click",function(){return initializePlayer(d),$("#splash_screen").hide(),!1}),d=d.toLowerCase().replace("-","_").replace(" ","_"),$(this).fileExist(h,"mp3"),$(this).fileExist(h,"pdf")},$.fn.displayError=function(e,i){var t,n;switch(e){case 0:t="<strong>Error 0</strong> - Not connect. Please verify network.";break;case 404:t="<strong>Error 404</strong> - Requested page not found.";break;case 406:t="<strong>Error 406</strong> - Not acceptable error.";break;case 500:t="<strong>Error 500</strong> - Internal Server Error.";break;default:t="Unknow error ... "+e}switch(i){case"parsererror":n="Invalid XML. XML parse failed.";break;case"timeout":n="XML parsing timed out.";break;case"abort":n="Ajax request aborted.";break;case"error":n="Failed to get requested source. Most likely a 404 or 406.";break;default:n="Uncaught Error ... "+e.responseText}$("#splash_screen, #player").hide(),$("#errorMsg").html("<p>"+t+"<br />"+n+"</p>")},$.fn.splitSelections=function(e){var i=e.split("|");return i},$.fn.fileExist=function(e,i){var t="audio/mpeg";"pdf"===i&&(t="application/pdf"),$.ajax({url:e+"."+i,type:"HEAD",dataType:"text",contentType:t,async:!1,beforeSend:function(e){e.overrideMimeType(t),e.setRequestHeader("Accept",t)},success:function(){var t=e,n="Audio",r=$("#download_bar ul"),a=window.location.protocol;if("http:"!==a){var o=window.location.href;o=o.substr(0,o.lastIndexOf("/")+1).replace("https","http"),t=o+e}"pdf"===i&&(n="Transcript"),r.append('<li><a href="'+t+"."+i+'" target="_blank"><span class="icon-arrow-down"><span> '+n+"</a></li>")},error:function(){}})},$.fn.getDirectory=function(){var e=window.location.href,i;return i=e.split("?"),i=i[0].split("/"),i=i[i.length-2]};